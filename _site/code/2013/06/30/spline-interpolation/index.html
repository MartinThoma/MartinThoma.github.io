<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Spline interpolation</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Martin Thoma</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Spline interpolation</h2>
<p class="meta">30 Jun 2013</p>

<div class="post">
<p>Just like before with polynomial interpolation, we have a list of $n+1$ given point $(x_i, y_i)$ with $x_0 &lt; x_1 &lt; \dots &lt; x_n$.</p>

<p>We want to find a function that goes through those points and approximates the underlying function that produced that points as good as possible.</p>

<h2>Polynomial interpolation</h2>


<p>The problem of polynomial interpolation were oscillations at the end of the interval you wanted to interpolate (see <a href="http://martin-thoma.com/html5/polynom-interpolation.htm?function=1%2F(25*x*x%2B1)&evaluationSteps=0.01&X_MIN=-1.5&X_MAX=1.5&Y_MAX=1.2&Y_MIN=-1.2&X_TICKS_STEPS=0.2&Y_TICKS_STEPS=0.2&X_FROM=-1&X_TO=1&N_EVALUATION_POINTS=10&points=%5B%5D&tschebyscheffSwitch=true&equallySwitch=true">interactive example</a>):</p>

<p>[caption id="attachment_72001" align="aligncenter" width="300"]<a href="http://martin-thoma.com/wp-content/uploads/2013/06/polynomial-interpolation-oscillation.png"><img src="http://martin-thoma.com/wp-content/uploads/2013/06/polynomial-interpolation-oscillation-300x105.png" alt="Oscillations you get with polynomial interpolation" width="300" height="105" class="size-medium wp-image-72001" /></a> Oscillations you get with polynomial interpolation[/caption]</p>

<p>As you can see, polynomial interpolation with equally spaced points is very, very bad at the ends of the interval. Tschebyscheff spaced points are much better, but you can still see that the interpolated function is different from the original.</p>

<h2>Splines</h2>


<p>A way to solve this problem are splines. A spline is a piecewise-defined function that goes through some points (aka knots) and is smooth.</p>

<p>More formally: Let $s: [x_0,x_n] \rightarrow \mathbb{R}$ be a spline. Then:</p>

<ol style="list-style-type: none;">
  <li>(S1) <strong>cubic</strong>: $\forall i \in \{1, \dots, n\}: s|_{x_{i-1}, x_i}$ is a cubic function</li>
  <li>(S2) <strong>interpolation</strong>: $\forall i \in \{0, \dots, n\}: s(x_i) = y_i$</li>
  <li>(S3) <strong>smooth</strong>: $s \in C^2([x_0, x_n])$ and $\int_{x_0}^{x_n} s''(x)^2 \mathrm{d}x$ is minimal</li> 
</ol>


<p>When you use a cubic function $a x<sup>3</sup> + b x<sup>2</sup> + cx + d$ for each of the $n$ intervals that we got by our $n+1$ points, you have $4n$ variables that you need to calculate.</p>

<p>Condition (S2) gives two equations per interval which makes $2n$ equations of the form:</p>

<p>$
\begin{align}
y_i     &amp;= a_i x_i<sup>3</sup>     &amp;&amp;+ b_i x_i<sup>2</sup>     &amp;&amp;+ c_i x_i     &amp;&amp;+ d_i\
y<em>{i+1} &amp;= a_i x</em>{i+1}^3 &amp;&amp;+ b_i x<em>{i+1}^2 &amp;&amp;+ c_i x</em>{i+1} &amp;&amp;+ d_i
\end{align}
$</p>

<p>At first glance condition (S3) - $s \in C<sup>2</sup>([x_0, x_n])$ - seems to be redundant with (S1) - $s$ is piecewise cubic. Every polynomial is in $C^\infty(\mathbb{R})$, so it certainly is in $C<sup>2</sup>([x_0, x_n])$.<br/>
That's correct. But $s$ is not a polynomial. It's only piecewise-defined as a polynomial. That makes a difference at the ends of the intervals. And it gives us $2n-2$ more equations:</p>

<p>$\displaystyle
\begin{align}
s_i' (x<em>{i}) &amp;= s</em>{i+1}'(x<em>{i}) \;\;\;  &amp;&amp;\forall i=1, \dots, n-1\
s_i''(x</em>{i}) &amp;= s<em>{i+1}''(x</em>{i}) \;\;\; &amp;&amp;\forall i=1, \dots, n-1
\end{align}
$</p>

<p>which is equivalent to</p>

<p>$\displaystyle
\begin{align}
3a_i x_i<sup>2</sup> + 2b_i x_i + c_i &amp;= 3a<em>{i+1} x_i<sup>2</sup> + 2b</em>{i+1} x_i + c<em>{i+1} \;\;\; &amp;&amp;\forall i=1, \dots, n-1\
6a_i x_i + 2b_i &amp;= 6a</em>{i+1} x_i + 2b_{i+1} \;\;\; &amp;&amp;\forall i=1, \dots, n-1
\end{align}
$</p>

<p>All equations we have are linear. Please note that the variables we want to determine are $a_i, b_i, c_i, d_i$. So $x_i<sup>3</sup>$ is simply a multiplicative constant that we have to evaluate before we solve our system of equations.</p>

<p>But at the moment, we only have $2n+2\cdot(n-1) = 4n -2$ equations, but we have $4n$ variables. So we need ancillary conditions to solve this linear system of equations.</p>

<h2>Possible ancillary conditions</h2>


<ul>
  <li><strong>natural splines</strong>: $s''(x_0) =0, \;\;\; s''(x_n) = 0$</li>
  <li><strong>clamped splines</strong>: $s'(x_0) = f'(x_0),\;\;\; s'(x_n)= f'(x_n)$ where $y_0'$ and $y_n'$ can be any value</li>
  <li><strong>periodic</strong>: $s'(x_0) = s'(x_n), \;\;\; s''(x_0) = s''(x_n)$</li>
  <li><strong>not-a-knot</strong>: $s_1''' = s_2''', \;\;\; s_{n-1}''' = s_{n}'''$</li>
</ul>


<p>George MacKerron shows how the results can differ in his article <a href="http://blog.mackerron.com/2011/01/01/javascript-cubic-splines/">Cubic splines in JavaScript (via CoffeeScript)</a>:</p>

<p>[caption id="attachment_72221" align="aligncenter" width="500"]<a href="http://martin-thoma.com/wp-content/uploads/2013/06/ancillary-conditions-splines-results.png"><img src="http://martin-thoma.com/wp-content/uploads/2013/06/ancillary-conditions-splines-results.png" alt="Different results for different ancillary conditions" width="500" height="267" class="size-full wp-image-72221" /></a> Different results for different ancillary conditions[/caption]</p>

<h2>Code for natural splines</h2>


<p>I will store splines as a list of maps. Each map is one piece of the spline and has:</p>

<ul>
  <li>$u$: Start of the interval</li>
  <li>$v$: End of the interval</li>
  <li>$a,b,c,d$: cubic function $ax^3 + bx^2 + cx +d$</li>
</ul>


<p>Please note that I didn't test the code below. It's likely that there are errors with indices.</p>

<div class="highlight"><pre><code class="python"><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="k">def</span> <span class="nf">niceCubicPolynomial</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot; x^3&quot;</span>
    <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">x^3&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">+ x^2&quot;</span>
    <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">+ </span><span class="si">%.2f</span><span class="s">x^2&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">+ x&quot;</span>
    <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">+ </span><span class="si">%.2f</span><span class="s">x&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&quot;</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;d&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">+ </span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;d&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tmp</span>

<span class="k">def</span> <span class="nf">getSpline</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; points should be a list of maps, </span>
<span class="sd">        where each map represents a point and has &quot;x&quot; and &quot;y&quot; &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">scipy.linalg</span>

    <span class="c"># sort points by x value</span>
    <span class="n">points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">point</span><span class="p">:</span> <span class="n">point</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">])</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c"># Set up a system of equations of form Ax=b</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="c"># 2n equations from condtions (S2)</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;y&quot;</span><span class="p">]</span>

        <span class="n">A</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">A</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">A</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span>
        <span class="n">A</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s">&quot;y&quot;</span><span class="p">]</span>

        <span class="c"># 2n-2 equations for (S3):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c"># point i is an inner point</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c"># Natural spline:</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">6</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">0</span>

    <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">6</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">0</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">spline</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">spline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;u&quot;</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">],</span> <span class="s">&quot;v&quot;</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">],</span>
                        <span class="s">&quot;a&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="s">&quot;b&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="s">&quot;c&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
                        <span class="s">&quot;d&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">])})</span>
    <span class="k">return</span> <span class="n">spline</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">})</span>
    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;x&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">})</span>
    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;x&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">})</span>
    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;x&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">})</span>
    <span class="n">spline</span> <span class="o">=</span> <span class="n">getSpline</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">spline</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="s">&quot;[</span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">]:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&quot;u&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;v&quot;</span><span class="p">])</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="n">niceCubicPolynomial</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</code></pre></div>




<h2>See also</h2>


<ul>
  <li><a href="http://math.stackexchange.com/q/430141/6876">How do the different ancillary conditions for splines differ?</a></li>
</ul>



<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
</div>

            <div class="footer">
    <div class="contact">
      <p>
        Martin<br />
        What You Are<br />
        you@example.com
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="https://github.com/yourusername">github.com/yourusername</a><br />
        <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
      </p>
    </div>
  </div>

        </div>
    </body>
</html>
