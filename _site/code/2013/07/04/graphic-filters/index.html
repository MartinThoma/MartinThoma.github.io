<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Graphic filters</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Martin Thoma</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Graphic filters</h2>
<p class="meta">04 Jul 2013</p>

<div class="post">
<p>I begin to fall in love with JavaScript and HTML5. You can access your Webcam with JS! As an example, I've implemented some graphic filters.</p>

<h2>Basics</h2>


<h3>HTML5</h3>


<p>You need:</p>

<ul>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas"><canvas></a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video"><video></a></li>
</ul>


<p>This is the bare minimum HTML code you need for valid HTML:</p>

<p>[html]
&lt;!DOCTYPE html>
<html>
    <head>
        <title>Some title</title>
    </head>
    <body>
        <video autoplay id="vid" style="display:none;"></video>
        <canvas id="canvas" width="640" height="480"></canvas>
        <script type="text/javascript" src="graphic-filter.js">
        </script>
    </body>
</html>
[/html]</p>

<h3>JavaScript</h3>


<p>Important functions / datastructures are:</p>

<ul>
  <li><a href="https://developer.mozilla.org/en-US/docs/WebRTC/navigator.getUserMedia">getUserMedia</a>: see <a href="http://caniuse.com/stream">support by browsers</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageData">ImageData</a>: WTF? The image is a ONE dimensional array of integers in 0, ..., 255. So the first 4 array elements describe the pixel (0|0) with its RGBA value</li>
</ul>


<p>A starting point for your code might be:</p>

<p>[javascript]
'use strict';</p>

<p>var video = document.querySelector("#vid");
var canvas = document.querySelector('#canvas');
var context = canvas.getContext('2d');
var localMediaStream = null;</p>

<p>var onCameraFail = function (e) {
    console.log('Camera did not work.', e);
};</p>

<p>setInterval(function snapshot() {
    if (localMediaStream) {
        context.drawImage(video, 0, 0);
        var width = 640;
        var height = 480;
        var imgDataNormal = context.getImageData(0, 0, width, height);
        var imgData = context.createImageData(width, height);</p>

<pre><code>    // convert image to grayscale
    for (var i = 0; i &lt; imgData.width*imgData.height*4; i += 4) {
        var r = imgDataNormal.data[i + 0];
        var g = imgDataNormal.data[i + 1];
        var b = imgDataNormal.data[i + 2];
        var brightness = (3*r+4*g+b)&gt;&gt;&gt;3;
        imgData.data[i] = brightness;
        imgData.data[i+1] = brightness;
        imgData.data[i+2] = brightness;
    }

    context.putImageData(imgData, 0, 0);
}
</code></pre>

<p>}, 500);</p>

<p>navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
window.URL = window.URL || window.webkitURL;
navigator.getUserMedia({video:true}, function (stream) {
    video.src = window.URL.createObjectURL(stream);
    localMediaStream = stream;
}, onCameraFail);
console.log(localMediaStream);
[/javascript]</p>

<h2>Interactive example</h2>


<div class="info">
You need a webcam for this:
<a href="http://martin-thoma.com/html5/graphic-filters/graphic-filters.htm" target="_blank">Open demonstration in new window</a>
</div>


<p>This is what it should look like:
[caption id="attachment_72801" align="aligncenter" width="664"]<a href="http://martin-thoma.com/wp-content/uploads/2013/07/graphic-webcam-html5-js-example.png"><img src="http://martin-thoma.com/wp-content/uploads/2013/07/graphic-webcam-html5-js-example.png" alt="Webcam example" width="664" height="395" class="size-full wp-image-72801" /></a> Webcam example[/caption]</p>

<p>And it gives these results:
[gallery ids="72871,72861,72831"]</p>

<p>By the way, you can check if a website is currently accessing your webcam (with Google Chrome):</p>

<p>[caption id="attachment_72811" align="aligncenter" width="370"]<a href="http://martin-thoma.com/wp-content/uploads/2013/07/webcam-red-dot.png"><img src="http://martin-thoma.com/wp-content/uploads/2013/07/webcam-red-dot.png" alt="Webcam indicator on tab in Google Chrome" width="370" height="125" class="size-full wp-image-72811" /></a> Webcam indicator on tab in Google Chrome[/caption]</p>

<p>If you want to use these examples from your Android phone, you might have to enable getUserMedia. To do this, enable "Web RTC" in "chrome://flags":
[caption id="attachment_73191" align="aligncenter" width="180"]<a href="http://martin-thoma.com/wp-content/uploads/2013/07/enable-webrtc.png"><img src="http://martin-thoma.com/wp-content/uploads/2013/07/enable-webrtc-180x300.png" alt="Enamble Web-RTC in Chrome for Android" width="180" height="300" class="size-medium wp-image-73191" /></a> Enamble Web-RTC in Chrome for Android[/caption]</p>


<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
</div>

            <div class="footer">
    <div class="contact">
      <p>
        Martin<br />
        What You Are<br />
        you@example.com
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="https://github.com/yourusername">github.com/yourusername</a><br />
        <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
      </p>
    </div>
  </div>

        </div>
    </body>
</html>
