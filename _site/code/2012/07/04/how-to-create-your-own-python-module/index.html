<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>How to create your own Python module</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Martin Thoma</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>How to create your own Python module</h2>
<p class="meta">04 Jul 2012</p>

<div class="post">
<p>A python module is a container for some definitions and statements. You generally call it like this:</p>

<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">math</span>
</code></pre></div>


<p>or like that</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>
</code></pre></div>


<p>or</p>

<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">math</span> <span class="kn">as</span> <span class="nn">mymath</span>
</code></pre></div>


<p>Python modules can also be written in C or C++, but I'll only explain how to write the module in Python. Modules can be written in C++ for performance reasons. Just take a look at <code>/usr/lib/python3.1/lib-dynload</code> with all the *.so files (shared libraries).</p>

<h2>Python Paths</h2>


<p>When you try to import a module, Python looks at these directories in the given order:</p>

<ul>
  <li>the PYTHONPATH</li>
  <li>the current working directory</li>
  <li>the default search path</li>
</ul>


<p>You get your PYTHONPATH and your default search path like this:</p>

<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;PATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;PYTHONPATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
</code></pre></div>




<h2>Example</h2>


<p>I've just searched for a Python module for primes. It seems as if no such module existed. So I wrote the module <strong>primes.py</strong>.</p>

<div class="highlight"><pre><code class="python"><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module offers some functions related to primes.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">miller_rabin</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="sd">&quot;&quot;&quot; Source: http://en.literateprograms.org/</span>
<span class="sd">                    Miller-Rabin_primality_test_(Python)</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">d</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">repeat</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">miller_rabin_pass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">miller_rabin_pass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">a_to_power</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a_to_power</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a_to_power</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">a_to_power</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_to_power</span> <span class="o">*</span> <span class="n">a_to_power</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">a_to_power</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">getPrimeFactors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the prime factors of n.</span>

<span class="sd">    If the result is small enough to fit in an int, return an int.</span>
<span class="sd">    Else return a long.</span>

<span class="sd">    &gt;&gt;&gt; [getPrimeFactors(n) for n in range(11)]</span>
<span class="sd">    [[], [], [2], [3], [2, 2], [5], [2, 3], [7], [2, 2, 2], [3, 3], [2, 5]]</span>

<span class="sd">    &gt;&gt;&gt; getPrimeFactors(36)</span>
<span class="sd">    [2, 2, 3, 3]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;n must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;n must be exact integer&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">2147483647</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="n">fact</span>  <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fact</span>

    <span class="k">while</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fact</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">/=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fact</span>

    <span class="k">if</span> <span class="n">miller_rabin</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">fact</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fact</span>

    <span class="n">check</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">rootn</span> <span class="o">=</span> <span class="n">n</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">%</span> <span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fact</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">/=</span> <span class="n">check</span>
        <span class="n">check</span><span class="o">+=</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">fact</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</code></pre></div>




<h2>See also</h2>


<ul>
  <li><a href="http://docs.python.org/tutorial/modules.html">Modules</a></li>
  <li><a href="http://www.python-kurs.eu/modularisierung.php">Modularisierung</a> (German)</li>
  <li><a href="http://stackoverflow.com/q/7948494/562769">What's the difference between a Python module and a Python package?</a></li>
  <li>Packages:
      <ul>
          <li><a href="http://guide.python-distribute.org/creation.html">Creating a Package</a></li>
          <li><a href="http://docs.python.org/distutils/introduction.html">An Introduction to Distutils</a></li>
      </ul>
  </li>
</ul>



<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
</div>

            <div class="footer">
    <div class="contact">
      <p>
        Martin<br />
        What You Are<br />
        you@example.com
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="https://github.com/yourusername">github.com/yourusername</a><br />
        <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
      </p>
    </div>
  </div>

        </div>
    </body>
</html>
