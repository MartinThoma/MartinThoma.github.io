<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Java Puzzle #1: Pre- and Postincrement</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Martin Thoma</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Java Puzzle #1: Pre- and Postincrement</h2>
<p class="meta">11 Jul 2012</p>

<div class="post">
<h2>The puzzle</h2>


<p>What is the output of the following piece of code?</p>

<p>[java]public class test {
    public static void main(String[] args) {
        int i = 1;
        i += ++i + i++ + ++i;</p>

<pre><code>    int j = 1;
    j += ++j + j++ + ++j;

    int k = 1;
    k += k++ + k++ + ++k;

    int m = 1;

    System.out.println("i = " + i);
    System.out.println("j = " + j);
    System.out.println("k = " + k);
    System.out.println("m = " + (m += 1));
}
</code></pre>

<p>}[/java]</p>

<p>.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.</p>

<h2>Answer</h2>


<p>The output is:
[bash]i = 9
j = 9
k = 8
m = 2[/bash]</p>

<h2>Explanation</h2>


<h3>Part one</h3>


<p>First, take a look at statements of this structure:
[java]i += s[/java]
where <code>i</code> is the integer and s is a statement (e.g. <code>++i</code>). This gets evaluated to
[java]i = a + s[/java]
Source: <a href="http://wordpress.org/extend/plugins/embed-github-gist/">docs.oracle.com</a></p>

<h3>Part two</h3>


<p>Lets take a look at pre- and postincrement in Java.</p>

<p>You can quite easily figure out what the different increments do by this snippet:
[java]public class test {
    public static void main(String[] args) {
        int i = 0;
        int j = 0;
        int k = 0;</p>

<pre><code>    System.out.println("i = " + ++i);
    System.out.println("i = " + i);

    System.out.println("j = " + j++);
    System.out.println("j = " + j);

    System.out.println("k = " + (k += 1));
}
</code></pre>

<p>}[/java]
Output:
[bash]i = 1
i = 1
j = 0
j = 1
k = 1[/bash]</p>

<p>Line 7 adds +1 to <code>i</code> and returns the value.
Line 10 returns the value of <code>j</code> and adds +1 to <code>j</code>.
Line 13 adds +1 to <code>k</code> and returns <code>k</code>.</p>

<p>Lets return to the original puzzle. Java parses your code from left to right (<a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/operators.html">Source 1</a>, <a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.1">Source 2</a>).</p>

<p>Most important:</p>

<blockquote>Evaluation of an expression can also produce side effects, because expressions may contain embedded assignments, increment operators, decrement operators, and method invocations.</blockquote>


<p>So:
[java]int i = 1;
i += ++i + i++ + ++i;[/java]
is the same as
[java]i = ((i + (++i)) + (i++)) + (++i);[/java]
The first <code>++i</code> increments <code>i</code> to 2 and returns 2. So you have:
[java]i = 2;
i = ((1 + 2) + (i++)) + (++i);[/java]
The <code>i++</code> returns 2, as it is the new value of <code>i</code>, and increments <code>i</code> to 3:</p>

<p>[java]i = 3;
i = ((1 + 2) + 2) + ++i;[/java]</p>

<p>The second <code>++i</code> increments <code>i</code> to 4 and returns 4:
[java]i = 4;
i += ((1 + 2) + 2) + 4;[/java]</p>

<p>So you end up with <code>9</code>.</p>

<p>A <a href="http://en.wikipedia.org/wiki/Parse_tree">parse tree</a> of this evaluation would look like this:
[caption id="attachment_30711" align="aligncenter" width="454"]<a href="http://martin-thoma.com/wp-content/uploads/2012/07/evaluation-tree.gif"><img src="http://martin-thoma.com/wp-content/uploads/2012/07/evaluation-tree.gif" alt="Parse tree" title="Parse tree" width="454" height="638" class="size-full wp-image-30711" /></a> Parse tree[/caption]</p>

<p>The explanation for the other three ones is similar.</p>

<h2>See also</h2>


<ul>
  <li><a href="http://en.wikipedia.org/wiki/Increment_and_decrement_operators">Increment and decrement operators</a></li>
  <li><a href="http://stackoverflow.com/q/971312/562769">Why avoid increment (&ldquo;++&rdquo;) and decrement (&ldquo;--&rdquo;) operators in JavaScript?</a></li>
  <li><a href="http://stackoverflow.com/q/11431914/562769">Pre- and postincrement in Java</a></li>
</ul>



<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
</div>

            <div class="footer">
    <div class="contact">
      <p>
        Martin<br />
        What You Are<br />
        you@example.com
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="https://github.com/yourusername">github.com/yourusername</a><br />
        <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
      </p>
    </div>
  </div>

        </div>
    </body>
</html>
