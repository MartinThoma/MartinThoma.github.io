<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Comparing Dates in PHP and MySQL</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Martin Thoma</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Comparing Dates in PHP and MySQL</h2>
<p class="meta">04 Oct 2011</p>

<div class="post">
<p>Sometimes you need to know compare PHP dates. You need to know what is later or if both dates are the same.</p>

<h2>PHP</h2>


<h3>time formats and functions</h3>


<p>PHP knows these time / date formats:</p>

<ul>
  <li>UNIX Timestamp: Integer - The number of seconds after 1970. Related functions are 
    <ul>
       <li>int <a href="http://www.php.net/manual/en/function.mktime.php">mktime</a>([ int $hour = date("H") [, int $minute = date("i") [, int $second = date("s") [, int $month = date("n") [, int $day = date("j") [, int $year = date("Y") [, int $is_dst = -1 ]]]]]]])</li>
       <li>int <a href="http://www.php.net/manual/en/function.time.php">time</a>()</li>
       <li>string <a href="http://www.php.net/manual/en/function.date.php">date</a>( string $format [, int $timestamp = time() ] )</li>
       <li>int <a href="http://www.php.net/manual/en/function.strtotime.php">strtotime</a> ( string $time [, int $now ] )
I recommend using 'YYYY-MM-DD HH:mm:ss' if possible.</li>
    </ul>
  </li>
  <li>Associative Arrays. The array looks like this [php]Array
(
    [year] => 2006
    [month] => 12
    [day] => 12
    [hour] => 10
    [minute] => 0
    [second] => 0
    [fraction] => 0.5
    [warning_count] => 0
    [warnings] => Array()
    [error_count] => 0
    [errors] => Array()
    [is_localtime] => 
)[/php]
The related functions are:
    <ul>
        <li>array <a href="http://www.php.net/manual/en/function.date-parse.php">date_parse</a> (string $date)</li>
        <li>array <a href="http://php.net/manual/en/function.getdate.php">getdate</a> ([ int $timestamp = time() ] )</li>
    </ul>
  </li>
  <li><a href="http://php.net/manual/en/class.datetime.php">DateTime Class</a>: This class can do quite a lot. You should read the manual if you're interested in using it.</li>
</ul>




<h3>Comparisons</h3>


<p>Comparing UNIX Timestamps is like comparing integers. No problem.</p>

<p>Comparing Arrays is more interesting. What do you think will the following script print?
[php]&lt;?php</p>

<p>$d1 = date_parse ("2011-05-11");
$d2 = date_parse ("2011-05-11 13:00:00");</p>

<p>print_r($d1);
print_r($d2);</p>

<p>if ($d1 &lt; $d2) {
    echo '$d1 is less than $d2.';
} else if ($d1 == $d2) {
    echo '$d1 is equal to $d2.';
} else {
    echo '$d1 is greater than $d2.';
}</p>

<p>?>[/php]</p>

<p>It prints '$d1 is less than $d2.' as
[php]date_parse ("2011-05-11");[/php] is basically the same as
[php]date_parse ("2011-05-11 00:00:00");[/php]</p>

<p>You can compare the Array to an integer, but I don't know what PHP does. It seems as if the array would always be considered as beeing greater. If you use the functions you'll be fine.</p>

<h2>MySQL</h2>


<h3>time formats and functions</h3>


<p>MySQL knows these date and time <a href="http://dev.mysql.com/doc/refman/5.5/en/date-and-time-types.html">types</a> and those <a href="http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html">functions</a>. Here is a very short overview:</p>

<ul>
    <li><a href="http://dev.mysql.com/doc/refman/5.5/en/datetime.html">DATETIME</a>: 'YYYY-MM-DD HH:MM:SS'
range is from '1000-01-01 00:00:00' to '9999-12-31 23:59:59'</li>
    <li><a href="http://dev.mysql.com/doc/refman/5.5/en/datetime.html">DATE</a>: 'YYYY-MM-DD'
range is from '1000-01-01' to '9999-12-31'</li>
    <li><a href="http://dev.mysql.com/doc/refman/5.5/en/datetime.html">TIMESTAMP</a>: like DATETIME, but
range is from '1970-01-01 00:00:01' UTC to '2038-01-19 03:14:07' UTC</li>
</ul>


<p>Those examples show more than a long explanation:
[bash]mysql> SELECT CURTIME();
        -> '23:50:26'</p>

<h1>Adding zero will NOT convert it to a UNIX timestamp:</h1>

<p>mysql> SELECT CURTIME() + 0;
        -> 235026.000000 # An "integered" TIME</p>

<p>mysql> SELECT NOW( )
        -> '2011-10-04 18:33:45'</p>

<h1>Adding zero is a bad idea here, too:</h1>

<p>mysql> SELECT NOW( ) +0
        -> 20111004190945.000000 # An "integered" DATETIME</p>

<h1>If you want a UNIX Timestamp, use this function</h1>

<p>mysql> SELECT UNIX_TIMESTAMP();
        -> 1317746025
mysql> SELECT UNIX_TIMESTAMP('2011-10-04 18:33:45');
        -> 1317746025</p>

<h1>You can also convert it:</h1>

<p>mysql> SELECT UNIX_TIMESTAMP(<code>my_datetime_row</code>) FROM <code>my_table</code>
[/bash]</p>

<h3>Comparisons</h3>


<p>You can compare two DATETIMEs like this:
[sql]SELECT <code>my_row</code> FROM <code>my_table</code> WHEN <code>datetime1</code> &lt; <code>datetime2</code>[/sql]</p>

<p>It's of course not problem if you compare two UNIX Timestamps which are stored as integers in the database:
[sql]SELECT <code>my_row</code> FROM <code>my_table</code> WHEN <code>int1</code> &lt; <code>int2</code>[/sql]</p>

<p>But what happens if you compare a DATETIME with a Timestamp (integer)?
[sql]SELECT <code>my_row</code> FROM <code>my_table</code> WHEN <code>datetime1</code> &lt; UNIX_TIMESTAMP()[/sql]
This is basically:
[sql]SELECT <code>my_row</code> FROM <code>my_table</code> WHEN <code>datetime1</code> &lt; 1317750167[/sql]
And it compares the "integered" DATETIME 20111004210710 for 2011-10-04 21:07:10 with 1317750167. This is obviously crap. Don't do it. Never.
Instead you should convert your dates with UNIX_TIMESTAMP(your_datetime) or  FROM_UNIXTIME(unix_timestamp).</p>

<h2>Comparing MySQL types with PHP types</h2>


<p>The simplest way to compare MySQL DATE formats with PHP types is using strtotime(...) or date(...) if needed. If you have a DATETIME and you want to know if it's in the past, you can use
[php]if (strtotime($datetime) &lt; time()) {
   echo '$datetime is in the past.';
}[/php]</p>

<h2>From PHP to MySQL</h2>


<p>If you have a date you got via an date input field and want to submit it to MySQL, just use this piece of code:
[php]$mysqlFormat = date('Y-m-d H:i:s', strtotime($_POST['my_date']));[/php]</p>


<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
</div>

            <div class="footer">
    <div class="contact">
      <p>
        Martin<br />
        What You Are<br />
        you@example.com
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="https://github.com/yourusername">github.com/yourusername</a><br />
        <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
      </p>
    </div>
  </div>

        </div>
    </body>
</html>
