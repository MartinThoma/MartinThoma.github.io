<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Calculations with quaternions</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Martin Thoma</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Calculations with quaternions</h2>
<p class="meta">09 Sep 2013</p>

<div class="post">
<p><a href="https://en.wikipedia.org/wiki/Quaternion">Quaternions</a> are an expansion of the concept of complex numbers on structures with four (instead of two) components. A quaterion $h$ can be written as a vector or in the form of $h = h_0 + ih_1 + j h_2 + kh_3$, where $i, j$ and $k$ are related to the $i$ in complex numbers. Accordingly $h_0$ is often called real part and h_1, h_2, h_3 are called imaginary part of a quaternion.</p>

<p>For $i, j$ and $k$ the following rules are applied:</p>

<p>$i<sup>2</sup> = j<sup>2</sup> = k<sup>2</sup> = -1$
and
$ijk=-1$</p>

<h2>Basic rules</h2>


<p>From these rules follows:
$\begin{align} ij &amp;= k\ ji &amp;= -k\ jk &amp;= i\ kj &amp;= -i\ ki &amp;= j\ ik &amp;= -j \end{align}$</p>

<p>(<a href="http://math.stackexchange.com/q/487245/6876">proof</a>)</p>

<h2>Multiplication</h2>


<p>Now, obviously quaternions multiplication is not commutative: $ij = k \neq -k = ji$</p>

<p>But for numbers in $\mathbb{R}$, it is commutative (<a href="http://math.stackexchange.com/q/488271/6876">proof</a>).</p>

<p>The multiplication is:</p>

<p>$\begin{align}
x  y
&amp;=( x_0 y_0 - x_1 y_1 - x_2 y_2 - x_3 y_3)\
&amp;+( x_0 y_1 + x_1 y_0 + x_2 y_3 - x_3 y_2) \mathrm i\
&amp;+( x_0 y_2 - x_1 y_3 + x_2 y_0 + x_3 y_1) \mathrm j\
&amp;+( x_0 y_3 + x_1 y_2 - x_2 y_1 + x_3 y_0) \mathrm k
\end{align}$</p>

<h3>Calculating multiplicative inverse</h3>


<p>This means, when you're given an element $x = x_0 + x_1 \mathrm i + x_2 \mathrm j + x_3 \mathrm k$ its inverse $y$ can be calculated by solving the following linear system of equations:</p>

<p>$\begin{align}
x_0 y_0 - x_1 y_1 - x_2 y_2 - x_3 y_3 &amp;= 1\
x_0 y_1 + x_1 y_0 + x_2 y_3 - x_3 y_2 &amp;= 0\
x_0 y_2 - x_1 y_3 + x_2 y_0 + x_3 y_1 &amp;= 0\
x_0 y_3 + x_1 y_2 - x_2 y_1 + x_3 y_0 &amp;= 0\
\end{align}$</p>

<p>which can be written as:</p>

<p>$\left(\begin{array}{cccc|c}
    x_0 &amp; -x_1 &amp; -x_2 &amp; -x_3 &amp; 1\
    x_1 &amp;  x_0 &amp; -x_3 &amp;  x_2 &amp; 0\
    x_2 &amp;  x_3 &amp;  x_0 &amp; -x_1 &amp; 0\
    x_3 &amp; -x_2 &amp;  x_1 &amp;  x_0 &amp; 0
  \end{array}\right).$</p>

<p>According to <a href="http://www.mathworks.de/de/help/aeroblks/quaternioninverse.html">mathworks</a> it is</p>

<p>$y = \frac{x_0 - \mathrm i x_1 - \mathrm j x_2 - \mathrm k x_3}{x_0<sup>2</sup> + x_1<sup>2</sup> + x_2<sup>2</sup> + x_3<sup>2</sup>}$</p>

<h2>More</h2>


<h3>Conjugate</h3>


<p>Just like the complex conjugate is defined as</p>

<p>$\overline{z} = a - ib$ with $z=a+ib$</p>

<p>the conjugate of quaternions is defined as</p>

<p>$\bar x := x_0-x_1\mathrm i-x_2\mathrm j-x_3\mathrm k$ with $x=x_0+x_1\mathrm i+x_2\mathrm j+x_3\mathrm k$</p>

<h3>Rotating points</h3>


<p>Quaternions can be used to rotate points. It works like this:</p>

<p>$x' = q x \overline{q}$</p>

<p>Pretty simple, isn't it?</p>

<p>For example, if you had the point (2,0,0) and you wanted to rotated it by $q = (\frac{\sqrt{2}}{2}, 0, \frac{\sqrt{2}}{2}, 0)$ you would transform (2,0,0) to (2i+0k+0j) and calculate</p>

<p>$\begin{align}
x' &amp;= q x \overline{q}\
&amp;= (\frac{\sqrt{2}}{2}+\frac{\sqrt{2}}{2} \mathrm j) \cdot 2 \mathrm i \cdot (\frac{\sqrt{2}}{2} - \frac{\sqrt{2}}{2} \mathrm j)\
&amp;= (\sqrt{2} \mathrm i + \sqrt{2} \mathrm{ji}) \cdot (\frac{\sqrt{2}}{2} - \frac{\sqrt{2}}{2} \mathrm j)\
&amp;= (\sqrt{2} \mathrm i - \sqrt{2} \mathrm k) \cdot (\frac{\sqrt{2}}{2} - \frac{\sqrt{2}}{2} \mathrm j)\
&amp;= \mathrm i - \mathrm{ij} - \mathrm k + \mathrm{kj}\
&amp;= \mathrm{i - k -k - i}\
&amp;= -2 \mathrm k\
&amp;\Rightarrow x' = (0,0,-2)
\end{align}$</p>

<h3>Rotation matrix to quaternion</h3>


<p>Let $M$ be a rotation matrix and $m_{ij}$ be an entry of this matrix.</p>

<h4>General rule</h4>


<p>\begin{align}
s &amp;= \frac{1}{2} \sqrt{1 + \sum<em>{i=1}^3 m</em>{ii}}\
x &amp;= \frac{m<em>{32} - m</em>{23}}{4s}\
y &amp;= \frac{m<em>{13} - m</em>{31}}{4s}\
z &amp;= \frac{m<em>{21} - m</em>{12}}{4s}
\end{align}</p>

<p>resulting in the quaternion $(s, x, y, z)$.</p>

<h4>Special rule</h4>


<p>A rotation matrix</p>

<p>$R_y = \begin{pmatrix}
\cos(\theta)  &amp; 0 &amp; \sin(\theta)\
0             &amp; 1 &amp; 0\
-\sin(\theta) &amp; 0 &amp; \cos(\theta)
\end{pmatrix}$</p>

<p>can be transformed to a quaternion</p>

<p>$q = (\cos(\frac{\theta}{2}), \vec u \sin (\frac{\theta}{2}))$</p>

<p>where $\vec u$ describes the axis you rotate by.</p>

<p>In this case $R_y$ is the y-axis, so $\vec u = \begin{pmatrix}0\1\0\end{pmatrix}$.</p>


<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
</div>

            <div class="footer">
    <div class="contact">
      <p>
        Martin<br />
        What You Are<br />
        you@example.com
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="https://github.com/yourusername">github.com/yourusername</a><br />
        <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
      </p>
    </div>
  </div>

        </div>
    </body>
</html>
