<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Martin Thoma" />
        <meta name="copyright" content="Martin Thoma" />
        <link title = "Martin Thoma"
              type  = "application/opensearchdescription+xml"
              rel   = "search"
              href  = "../opensearch.xml">

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Machine Learning, Machine Learning, " />

<meta property="og:title" content="Perfect Models "/>
<meta property="og:url" content="../perfect-models/" />
<meta property="og:description" content="When you develop a model, you want the optimal model. The perfect one. The first problem with that desire are diagonal goals: Diagonal goals in model development Typical goals when designing a model are: Quality: Have a high accuracy, low error, high \(F_\beta\) score, ... Production Inference speed: The faster …" />
<meta property="og:site_name" content="Martin Thoma" />
<meta property="og:article:author" content="Martin Thoma" />
<meta property="og:article:published_time" content="2018-12-14T20:00:00+01:00" />
<meta name="twitter:title" content="Perfect Models ">
<meta name="twitter:description" content="When you develop a model, you want the optimal model. The perfect one. The first problem with that desire are diagonal goals: Diagonal goals in model development Typical goals when designing a model are: Quality: Have a high accuracy, low error, high \(F_\beta\) score, ... Production Inference speed: The faster …">
<meta property="og:image" content="logos/ml.png" />
<meta name="twitter:image" content="logos/ml.png" >

        <title>Perfect Models  · Martin Thoma
</title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../static/print.css" media="print">
        <link rel="stylesheet" type="text/css" href="../static/custom.css" media="screen">

        <!-- MathJax -->
<script type="text/x-mathjax-config">
<!--
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [ ['$$', '$$'], ['\\[','\\]']],
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    processEscapes: true
  }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
// -->
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

        <link href="https://martin-thoma.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Martin Thoma - Full Atom Feed" />
        <link href="https://martin-thoma.com/feeds/index.xml" type="application/rss+xml" rel="alternate" title="Martin Thoma - Full RSS Feed" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top navbar-default">
            <div class="container">
                <div class="container-fluid">
                    <div class="collapse navbar-collapse">
                        <ul class="nav pull-left top-menu navbar-nav">
                            <li><a href=".." style="font-family: 'Monaco', 'Inconsolata', 'Andale Mono', 'Lucida Console', 'Bitstream Vera Sans Mono', 'Courier New', Courier, Monospace;
                        font-size: 20px;" class="navbar-brand">Martin Thoma</a>
                            </li>
                        </ul>
                        <ul class="nav pull-right top-menu navbar-nav">
                            <li ><a href="..">Home</a></li>
                            <li ><a href="../categories.html">Categories</a></li>
                            <li ><a href="../tags.html">Tags</a></li>
                            <li ><a href="../archives.html">Archives</a></li>
                            <li><a href="../support-me/">Support me</a></li>
                            <li><form class="navbar-form" action="../search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="search" class="search-query form-control" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-1 col-md-1"></div>
                <div class="col-sm-10 col-md-10">
<article>
<div class="row">
    <header class="page-header col-sm-10 col-md-10 col-md-offset-2">
    <h1><a href="../perfect-models/"> Perfect Models  </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-sm-2 col-md-2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div id="toc"><ul><li><a class="toc-href" href="#tensorflow-playground" title="Tensorflow Playground">Tensorflow Playground</a><ul><li><a class="toc-href" href="#exclusive-or" title="Exclusive Or">Exclusive Or</a></li><li><a class="toc-href" href="#circle-dataset" title="Circle Dataset">Circle Dataset</a></li><li><a class="toc-href" href="#gaussian" title="Gaussian">Gaussian</a></li><li><a class="toc-href" href="#spirals" title="Spirals">Spirals</a></li></ul></li><li><a class="toc-href" href="#how-regularization-can-destroy-your-model_1" title="How Regularization can destroy your model">How Regularization can destroy your model</a></li></ul></div>
        </nav>
    </div>
    <div class="col-sm-8 col-md-8 article-content" id="contentAfterTitle">

            
            <p>When you develop a model, you want the optimal model. The perfect one.</p>
<p>The first problem with that desire are diagonal goals:</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2018/12/model-pick-2.png"><img alt="A jellyfish" src="../images/2018/12/model-pick-2.png" style="width: 512px;"/></a>
<figcaption class="text-center">Diagonal goals in model development</figcaption>
</figure>
<p>Typical goals when designing a model are:</p>
<ul>
<li>Quality: Have a high accuracy, low error, high <span class="math">\(F_\beta\)</span> score, ...</li>
<li>Production<ul>
<li>Inference speed: The faster it is in production, the better</li>
<li>Inference memory consumtion: Super important if it should run on small machines</li>
</ul>
</li>
<li>Training:<ul>
<li>Training speed: The more episodes you can train in 1h, the better</li>
<li>Convergence speed: The less episodes you need until convergence, the better</li>
<li>Training memory consumption: You might have a small GPU for training</li>
<li>Stability: If you train with 10 different initializations, you want to get 10 similar results</li>
</ul>
</li>
</ul>
<p>Sometimes, however, you can build perfect models. It is basically when you
know how the data generating process works.</p>
<h2 id="tensorflow-playground">Tensorflow Playground</h2>
<p>Let's get some perfect solutions for Tensorflow playground.</p>
<p>All of the datasets have points <span class="math">\((x_1, x_2)\)</span> which are assigned to either the
blue class or to the orange class.</p>
<p>The only input-features you can choose are</p>
<ul>
<li><span class="math">\(x_1, x_2\)</span>: Linear</li>
<li><span class="math">\(x_1^2, x_2^2\)</span>: Quadratic</li>
<li><span class="math">\(x_1 \cdot x_2\)</span>: Multiplication</li>
<li><span class="math">\(\sin(x_1), \sin(x_2)\)</span></li>
</ul>
<h3 id="exclusive-or">Exclusive Or</h3>
<p>You can generate this dataset by drawing <span class="math">\((x_1, x_2)\)</span> from <span class="math">\([-1, 1] \times [-1, 1]\)</span>
and assigning the classes by</p>
<div class="math">\begin{cases}
    (x_1 &gt; 0 \text{ AND } x_2 &gt; 0) OR (x_1 &lt; 0 \text{ AND } x_2 &lt; 0)&amp;\text{orange}\\
    (x_1 &gt; 0 \text{ AND } x_2 &lt; 0) OR (x_1 &lt; 0 \text{ AND } x_2 &gt; 0)&amp;\text{blue}\\
\end{cases}</div>
<p>It happens to be that this property is the case when you multiply the two values:</p>
<div class="math">\begin{cases}
    x_1 \cdot x_2 &gt; 0&amp;\text{orange}\\
    x_1 \cdot x_2 &lt; 0&amp;\text{blue}\\
\end{cases}</div>
<p>Hence with multiplication you can get the function directly:</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2018/12/xor-dataset.png"><img alt="XOR dataset solution" src="../images/2018/12/xor-dataset.png" style="width: 512px;"/></a>
<figcaption class="text-center">XOR dataset solution</figcaption>
</figure>
<h3 id="circle-dataset">Circle Dataset</h3>
<p>The circle dataset can be generated by drawing <span class="math">\(r \in [0, 6]\)</span> and <span class="math">\(\theta \in [0, 1]\)</span>.
The rule to assign the class is then</p>
<p>$$
</p>
<div class="math">\begin{align}
x_1 &amp;= r \cdot \cos(\theta)\\
x_2 &amp;= r \cdot \sin(\theta)
\end{align}</div>
<p>and then</p>
<div class="math">$$
\begin{cases}
    x_1^2 + x_2^2 &lt; t&amp;\text{blue}\\
    x_1^2 + x_2^2 \geq t &amp; \text{orange}
\end{cases}
$$</div>
<p>Here the solution is pretty obvious: It's a linear model of the squared inputs:</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2018/12/circles-dataset.png"><img alt="Circles dataset solution" src="../images/2018/12/circles-dataset.png" style="width: 512px;"/></a>
<figcaption class="text-center">Circles dataset solution</figcaption>
</figure>
<h3 id="gaussian">Gaussian</h3>
<p>The Gaussian dataset seems to have the blue center in <span class="math">\((2, 2)\)</span> and the orange
center in <span class="math">\((-2, -2)\)</span>. This is a bit more difficult to generate, but you can see
that the optimal decision boundary is <span class="math">\(x_2 = -x_1\)</span>. Everything below is more
likely to be orange, everything above is more likely to be blue.</p>
<div class="math">$$
\begin{cases}
    x_2 &lt; - x_1&amp;\text{orange}\\
    x_2 &gt; - x_1 &amp; \text{blue}
\end{cases}
$$</div>
<p>and hence the model:</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2018/12/gaussian-dataset.png"><img alt="Gaussian dataset solution" src="../images/2018/12/gaussian-dataset.png" style="width: 512px;"/></a>
<figcaption class="text-center">Gaussian dataset solution</figcaption>
</figure>
<h3 id="spirals">Spirals</h3>
<p>Generating the spirals is a bit more complicated. I've added a <a href="https://github.com/MartinThoma/algorithms/blob/master/ML/playground/dataset_generation.py">gist</a> which generates a dataset
which is super similar.</p>
<p>Basically, it is choosing <span class="math">\(r \in R_{\geq 0}\)</span>. The <span class="math">\(\alpha \in [0, 360)\)</span> defines
the class, e.g. <span class="math">\(\alpha_\text{orange}=180\)</span> and <span class="math">\(\alpha_\text{blue}=90\)</span></p>
<div class="math">$$
\begin{algin}
x_1 &amp;= -r \cdot \cos(\alpha)\\
x_2 &amp;= r \cdot \sin(\alpha)
\end{align}
$$</div>
<p>Hence finding the class is related to finding the <span class="math">\(\alpha\)</span>:</p>
<div class="math">$$
\begin{algin}
\cos^{-1}(-\frac{x_1}{r}) &amp;= \alpha\\
\sin^{-1}(\frac{x_2}{r}) &amp;= \alpha
\end{align}
$$</div>
<p>But neither <span class="math">\(\cos^{-1}\)</span> nor <span class="math">\(\sin^{-1}\)</span> are available as input features. And,
more relevant, we don't have <span class="math">\(r\)</span>. <span class="math">\(r\)</span> is basically the distance from the <span class="math">\((0, 0)\)</span>.
So <span class="math">\(r = \sqrt{x_1^2 + x_2^2}\)</span>. Hence we need <span class="math">\(x_1^2\)</span> and <span class="math">\(x_2^2\)</span> as features.</p>
<p>This is where I'm stuck. My intuition tells me that tanh is a nice activation
function for this problem, because it is one of the geometric functions. Let's
see how far we get with that:</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2018/12/spiral-dataset.png"><img alt="Spiral dataset solution" src="../images/2018/12/spiral-dataset.png" style="width: 512px;"/></a>
<figcaption class="text-center">Spiral dataset solution</figcaption>
</figure>
<p>So with 2 hidden layers, it can be done in about 250 episodes. No
regularization, only squared and linear features. But looking at the features
of the first hidden layer, we can see that it mostly builds circle-like
features. The spiral has only 3 rotations, so it is rather easy to fit it. My
guess is that the number of rotations directly influences the number of neurons
you need in the first hidden layer.</p>
<p>The training with a batch size of 8 often has a phase of big instability (high jumps in the loss curve).
Increasing the batch size leads to a more smooth loss curve.</p>
<p>Typically, after around 1000 epochs the training is done and the result looks
fine.</p>
<h2 id="how-regularization-can-destroy-your-model_1">How Regularization can destroy your model</h2>
<p>Look at <a href="https://playground.tensorflow.org/#activation=tanh&amp;batchSize=10&amp;dataset=spiral&amp;regDataset=reg-plane&amp;learningRate=0.03&amp;regularizationRate=0.03&amp;noise=0&amp;networkShape=8,2&amp;seed=0.13062&amp;showTestData=false&amp;discretize=false&amp;percTrainData=50&amp;x=true&amp;y=true&amp;xTimesY=false&amp;xSquared=false&amp;ySquared=false&amp;cosX=false&amp;sinX=true&amp;cosY=false&amp;sinY=true&amp;collectStats=false&amp;problem=classification&amp;initZero=false&amp;hideText=false">this network</a>.
If you add any regularization with a rate of 0.003 or more, it is not able to learn anymore.</p>
            
            <div id="disqus_thread" class="no-print"></div>
<script>
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');

        s.src = '//martinthoma.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

            <hr/>
        </div>
        <section>
        <div class="col-sm-2 col-md-2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2018-12-14T20:00:00+01:00">Dez 14, 2018</time>
            <br/>
            by <a rel="author" class="vcard author post-author" itemprop="author" href="../author/martin-thoma/"><span class="fn" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name">Martin Thoma</span></span></a>
            <h4>Category</h4>
            <a class="category-link" href="../categories.html#machine-learning-ref">Machine Learning</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="../tags.html#machine-learning-ref">Machine Learning
                    <span>77</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="https://twitter.com/themoosemind" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="mailto:info@martin-thoma.de" title="My Email Address" class="sidebar-social-links" target="_blank">
    <i class="fa fa-envelope sidebar-social-links"></i></a>
    <a href="https://github.com/MartinThoma" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="http://stackoverflow.com/users/562769/martin-thoma" title="My Stackoverflow Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-stackoverflow sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="col-sm-1 col-md-1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-subtitle"><span class="site-name">Martin Thoma</span> - A blog about Code, the Web and Cyberculture</li>
        <li><a href="http://www.martin-thoma.de/privacy.htm">Datenschutzerkl&auml;rung</a></li>
        <li><a href="http://www.martin-thoma.de/impressum.htm">Impressum</a></li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>        <script src="//code.jquery.com/jquery.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script>
(function(){
    'use strict';

    /*
    Create intra-page links
    Requires that your headings already have an `id` attribute set (because that's what jekyll does)
    For every heading in your page, this adds a little anchor link `#` that you can click to get a permalink to the heading.
    Ignores `h1`, because you should only have one per page.
    The text content of the tag is used to generate the link, so it will fail "gracefully-ish" if you have duplicate heading text.

    Credit: https://gist.github.com/SimplGy/a229d25cdb19d7f21231
     */

    var headingNodes = [], results, link,
        tags = ['h2', 'h3', 'h4', 'h5', 'h6'];

    tags.forEach(function(tag){
        var contentTag = document.getElementById('contentAfterTitle');
      results = contentTag.getElementsByTagName(tag);
      Array.prototype.push.apply(headingNodes, results);
    });

    headingNodes.forEach(function(node){
      link = document.createElement('a');
      link.className = 'deepLink';
      link.textContent = ' ¶';
      link.href = '#' + node.getAttribute('id');
      node.appendChild(link);
    });

  })();
</script>
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>