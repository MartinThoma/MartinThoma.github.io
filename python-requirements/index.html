<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Martin Thoma" />
        <meta name="copyright" content="Martin Thoma" />
        <link title = "Martin Thoma"
              type  = "application/opensearchdescription+xml"
              rel   = "search"
              href  = "../opensearch.xml">

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Python, setup.py, requirements.txt, Software Engineering, Code, " />

<meta property="og:title" content="Python Requirements"/>
<meta property="og:url" content="../python-requirements/" />
<meta property="og:description" content="Pythons package management is a constant source of confusion. One part of the confusion is in which format dependencies should get denoted. It gets worse, because there are too many tools. xkcd shows this pretty well: xkcd The Python environmental protection agency wants to seal it in a cement chamber …" />
<meta property="og:site_name" content="Martin Thoma" />
<meta property="og:article:author" content="Martin Thoma" />
<meta property="og:article:published_time" content="2020-05-16T20:00:00+02:00" />
<meta name="twitter:title" content="Python Requirements">
<meta name="twitter:description" content="Pythons package management is a constant source of confusion. One part of the confusion is in which format dependencies should get denoted. It gets worse, because there are too many tools. xkcd shows this pretty well: xkcd The Python environmental protection agency wants to seal it in a cement chamber …">
<meta property="og:image" content="logos/python.png" />
<meta name="twitter:image" content="logos/python.png" >

        <title>Python Requirements · Martin Thoma
</title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../static/print.css" media="print">
        <link rel="stylesheet" type="text/css" href="../static/custom.css" media="screen">

        <!-- MathJax -->
<script type="text/x-mathjax-config">
<!--
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [ ['$$', '$$'], ['\\[','\\]']],
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    processEscapes: true
  }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
// -->
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

        <link href="https://martin-thoma.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Martin Thoma - Full Atom Feed" />
        <link href="https://martin-thoma.com/feeds/index.xml" type="application/rss+xml" rel="alternate" title="Martin Thoma - Full RSS Feed" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top navbar-default">
            <div class="container">
                <div class="container-fluid">
                    <div class="collapse navbar-collapse">
                        <ul class="nav pull-left top-menu navbar-nav">
                            <li><a href=".." style="font-family: 'Monaco', 'Inconsolata', 'Andale Mono', 'Lucida Console', 'Bitstream Vera Sans Mono', 'Courier New', Courier, Monospace;
                        font-size: 20px;" class="navbar-brand">Martin Thoma</a>
                            </li>
                        </ul>
                        <ul class="nav pull-right top-menu navbar-nav">
                            <li ><a href="..">Home</a></li>
                            <li ><a href="../categories.html">Categories</a></li>
                            <li ><a href="../tags.html">Tags</a></li>
                            <li ><a href="../archives.html">Archives</a></li>
                            <li><a href="../support-me/">Support me</a></li>
                            <li><form class="navbar-form" action="../search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="search" class="search-query form-control" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-1 col-md-1"></div>
                <div class="col-sm-10 col-md-10">
<article>
<div class="row">
    <header class="page-header col-sm-10 col-md-10 col-md-offset-2">
    <h1><a href="../python-requirements/"> Python Requirements </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-sm-2 col-md-2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div id="toc"><ul><li><a class="toc-href" href="#how-code-is-shared" title="How Code is Shared">How Code is Shared</a></li><li><a class="toc-href" href="#sharable-code-types" title="Sharable Code Types">Sharable Code Types</a></li><li><a class="toc-href" href="#abstract-dependencies" title="Abstract Dependencies">Abstract Dependencies</a></li><li><a class="toc-href" href="#concrete-dependencies" title="Concrete Dependencies">Concrete Dependencies</a></li><li><a class="toc-href" href="#abstract-or-concrete-when-to-use-which" title="Abstract or Concrete: When to use which?">Abstract or Concrete: When to use which?</a></li><li><a class="toc-href" href="#distribution-formats" title="Distribution formats">Distribution formats</a><ul><li><a class="toc-href" href="#built-distributions" title="Built Distributions">Built Distributions</a></li><li><a class="toc-href" href="#source-distributions" title="Source Distributions">Source Distributions</a></li></ul></li><li><a class="toc-href" href="#version-pinning_1" title="Version pinning">Version pinning</a><ul><li><a class="toc-href" href="#pip-compile" title="pip-compile">pip-compile</a></li><li><a class="toc-href" href="#virtualenv-pip-freeze" title="virtualenv + pip freeze">virtualenv + pip freeze</a></li><li><a class="toc-href" href="#pipreqs" title="pipreqs">pipreqs</a></li></ul></li><li><a class="toc-href" href="#dependency-formats_1" title="Dependency Formats">Dependency Formats</a><ul><li><a class="toc-href" href="#requirementstxt" title="requirements.txt">requirements.txt</a></li><li><a class="toc-href" href="#setuppy" title="setup.py">setup.py</a></li><li><a class="toc-href" href="#setupcfg" title="setup.cfg">setup.cfg</a></li><li><a class="toc-href" href="#pyprojecttoml" title="pyproject.toml">pyproject.toml</a></li></ul></li><li><a class="toc-href" href="#tool-overview_1" title="Tool Overview">Tool Overview</a></li><li><a class="toc-href" href="#comparison-with-other-languages" title="Comparison with other Languages">Comparison with other Languages</a></li><li><a class="toc-href" href="#glossary" title="Glossary">Glossary</a></li><li><a class="toc-href" href="#see-also" title="See also">See also</a></li></ul></div>
        </nav>
    </div>
    <div class="col-sm-8 col-md-8 article-content" id="contentAfterTitle">

            
            <p>Pythons package management is a constant source of confusion. One part of the
confusion is in which format dependencies should get denoted. It gets worse, because there are <a href="https://stackoverflow.com/q/25337706/562769">too many tools</a>. <a href="https://xkcd.com/1987/">xkcd</a> shows this pretty well:</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="https://xkcd.com/1987/"><img alt="The Python environmental protection agency wants to seal it in a cement chamber, with pictorial messages to future civilizations warning them about the danger of using sudo to install random Python packages." src="https://imgs.xkcd.com/comics/python_environment.png" style="width: 512px;"/></a>
<figcaption class="text-center">xkcd The Python environmental protection agency wants to seal it in a cement chamber, with pictorial messages to future civilizations warning them about the danger of using sudo to install random Python packages. (<a href="https://www.explainxkcd.com/wiki/index.php/1987:_Python_Environment">explanation</a>)</figcaption>
</figure>
<p>After reading this post, you will know the difference between abstract and concrete requirements, the relationship between setup.py, setup.cfg, requirements.txt, Pipfile, Pipfile.lock, and pyproject.toml.</p>
<p>I will not cover at all anything related to Anaconda and it will not go into detail how to use various tools.</p>
<h2 id="how-code-is-shared">How Code is Shared</h2>
<p>Back in the old days, code was shared as actual boxes which you borrowed from the library - the building, not some other software. I'm talking about <a href="https://en.wikipedia.org/wiki/Punched_card">punch cards</a>. Then people moved to sharing code on the internet as simple snippets / functions. Things became bigger and more organized. From simple archives (e.g. zip files) to archives with structure. The archive file contained code in pre-defined places, contained some meta data such as the author and especially the required dependencies. This special kind of archive file was then called a package.</p>
<p>Packages need to be built. They can then be shared. Finally, they can be installed, used and removed.</p>
<p>Packages exist on the Python ecosystem level where you have the installer <code>pip</code> and the package repository PyPI, on the Anaconda level with the installer <code>conda</code> and the repository Anaconda Cloud and on the operating system level where you have tools like <code>apt</code> and the Ubuntu repositories. Of course, there are many more.</p>
<p>Also, you have self-extracting archives and specialized installers. They are super common on Windows.</p>
<h2 id="sharable-code-types">Sharable Code Types</h2>
<p>There are two very different types of sharable code to write: <strong>Applications</strong> and <strong>libraries</strong>. An application can have a command line interface (CLI), a graphical interface (GUI), be running as a web service or a system service, or it can just run regularly when events happen.</p>
<p>For libraries, the code never runs on its own. It is included in other code.</p>
<p>Please note that for this post, I consider a <strong>framework</strong> to be a special kind of library.</p>
<h2 id="abstract-dependencies">Abstract Dependencies</h2>
<p>The simplest way to share dependencies is by stating the names of the packages your code expects to be present. Not where one can get the dependency from, no version.</p>
<p>This is nice, because it allows the user of your code to have just any version of the dependency installed. The user might even be able to have an alternative implementation of the package installed, such as <code>Pillow</code> instead of <code>PIL</code> or <code>propy3</code> instead of <code>propy</code>. Just something that keeps the interfaces intact and you exposes the same names as imports.</p>
<h2 id="concrete-dependencies">Concrete Dependencies</h2>
<p>Abstract dependencies are nice, but sometimes the version is important. Sometimes interfaces break. Then you might want to point out which version range is acceptable. Or you might want to set an exact version.</p>
<h2 id="abstract-or-concrete-when-to-use-which">Abstract or Concrete: When to use which?</h2>
<p>For library/framework code, you want to have maximum flexibility. Your
library is likely not the only one your users use. If you give concrete
dependencies, you might make it impossible for your users to have one set of
packages installed which fulfills all requirements:</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2020/05/dependency-graph-pinning-conflict.svg"><img alt="A package version conflict if two packages pinned different versions of urllib" src="../images/2020/05/dependency-graph-pinning-conflict.svg" style="width: 512px;"/></a>
<figcaption class="text-center">A package version conflict if two packages pinned different versions of urllib</figcaption>
</figure>
<p>So, <strong>for library/framework code, you keep dependencies abstract</strong>.</p>
<p>For application code on the other hand, the user just wants to run the
application. You want to be as sure as possible that nothing fails. So you
specify concrete dependencies. You say for everything your application needs
where it comes from and in which version it is used. But this might not be
enough.</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2020/05/dependency-graph.png"><img alt="Dependency graph where wasabi could make things fail if only the version of spacy is pinned" src="../images/2020/05/dependency-graph.png" style="width: 512px;"/></a>
<figcaption class="text-center">Dependency graph where wasabi could make things fail if only the version of spacy is pinned</figcaption>
</figure>
<p>So, <strong>for application code, you specify concrete dependencies and you apply
version pinning</strong>. That means you specify the exact version you need for all of
your direct <strong>and</strong> indirect dependencies.</p>
<div class="alert alert-warning">The reason why this whole topic is so confusing, is the fact that the two concepts (application vs library) are not strictly seperated and that the file formats and tools have grown over time.</div>
<p>Practically, I suggest to keep dependencies in <code>setup.py</code> as loose as possible and add a <code>requirements.txt</code> which has pinned dependencies. This way one can install the package via pip and reasonably expect other things not to break while one can still use the <code>requirements.txt</code> and an virtual environment to isolate the application from the rest of the system.</p>
<p>You might think this is a shortcomming of the Python community not to allow packages to distinguish those two concepts and install "application packages" automatically in an isolated virtual environment with all their pinned dependencies. It's not. It's a design decision. The positive side of this is that it can save resources. You don't need to have dozens of duplicates of the same package on your disk. Also, when you load two libraries A and B which both depend on C, you only have C once in memory. The downside of it is that if you update that shared version, you can break things in unexpected ways.</p>
<p>Essentially you let the user decide what they want: Do they (a) want a small disk footprint or (b) isolation. If they want (a), they neey can install everything in the same environment. If they want (b), they need to use <code>venv</code> in some way, e.g. directly, via <code>virtualenv</code> or via <code>pipenv</code>.</p>
<p>Sadly, within one running environment it is not so easy to have multiple versions of the same package (<a href="https://stackoverflow.com/q/60084441/562769">source</a>).</p>
<h2 id="distribution-formats">Distribution formats</h2>
<p>Python packages are distributed in two relevant flavours: <strong>Source distributions</strong> (sdist) and <strong>built distributions</strong> (bdist, a special case is the "binary distribution").</p>
<h3 id="built-distributions">Built Distributions</h3>
<p>A <strong>built distribution</strong> can either be in the <a href="https://setuptools.readthedocs.io/en/latest/formats.html">egg format</a> (deprecated) or in the <a href="https://www.python.org/dev/peps/pep-0427/">wheels format</a>. There is no reason to use/build eggs anymore; use and build just wheels. The wheels format is newer and learned from shortcommings of the egg format. Wheels is specified in <a href="https://www.python.org/dev/peps/pep-0427/">PEP 427</a>.</p>
<h3 id="source-distributions">Source Distributions</h3>
<p>A <strong>source distribution</strong> is just sharing the source. It doesn't build anything. The advantage of this is that it is the same for all platforms (Windows, Linux, Mac) and machines (32 Bit / 64 Bit). The disadvantage is that users have to build the package themselves. This might include building Fortran / C code (e.g. for numpy and scipy). This also includes to get the dependencies.</p>
<p>Source distributions are typically created to use <a href="https://setuptools.readthedocs.io/en/latest/setuptools.html">setuptools</a> is it is around for a long time and installed on essentially every machine which has Python. <strong>If you want to install a source distribution using setuptools, you need a <code>setup.py</code> file</strong>. You can see the structure of such a file below.</p>
<p>Similar as egg was created to solve an issue and later replaced by a specified version (wheels), the setuptools build solution is getting superseeded by <code>pyproject.toml</code>. This file allows you to specify the build system you want. This includes <code>setuptools</code> (with <code>setup.py</code>), but is not limited to it.</p>
<h2 id="version-pinning_1">Version pinning</h2>
<p>Version pinning is the act of specifying the exact version of your
dependencies. Not only the direct dependencies, but also the indirect ones.</p>
<h3 id="pip-compile">pip-compile</h3>
<p>Create a <code>requirements.in</code> and run <code>pip-compile</code> from <a href="https://pypi.org/project/pip-tools/"><code>pip-tools</code></a>:</p>
<div class="highlight"><pre><span></span><code>$ pip-compile -U requirements.in
</code></pre></div>
<p>This is the solution I would recommend.</p>
<h3 id="virtualenv-pip-freeze">virtualenv + pip freeze</h3>
<p>An alternative option is to create a virtual environment, install the package, make sure everything works and write the installed dependencies versions in a <code>requirements.txt</code> file:</p>
<div class="highlight"><pre><span></span><code>$ virtualenv venv
$ <span class="nb">source</span> venv/bin/activate

<span class="c1"># Add additional targets, if wanted!</span>
$ pip install .

$ pip freeze &gt; requirements.txt
</code></pre></div>
<h3 id="pipreqs">pipreqs</h3>
<p>If you think your setup.py might miss something, try <a href="https://pypi.org/project/pipreqs/"><code>pipreqs</code></a>:</p>
<div class="highlight"><pre><span></span><code>$ pip install pipreqs
$ pipreqs /project/path
</code></pre></div>
<p>A similar tool is <a href="https://pypi.org/project/pipdeptree/"><code>pipdeptree</code></a>.</p>
<h2 id="dependency-formats_1">Dependency Formats</h2>
<p>There are two common formats to denote dependencies: Within the <code>setup.py</code> and
<code>requirements.txt</code> files.</p>
<p><code>setup.py</code> is used to install packages, whereas <code>requirements.txt</code> files are
used to prepare a development environment.</p>
<p>As an alternative to <code>requirements.txt</code>, you can use <code>Pipfile</code> + <code>Pipfile.lock</code>.
However, the <code>requirements.txt</code> is still the de facto standard.</p>
<h3 id="requirementstxt">requirements.txt</h3>
<p>The structure of a <code>requirements.txt</code> file is super simple:</p>
<div class="highlight"><pre><span></span><code>--index-url https://pypi.python.org/simple/
-e https://github.com/foo/bar.git#egg=bar
virtualenv==15.1.0
visitor==0.1.3
vtk==8.1.1
wadllib==1.3.2
watchdog==0.8.3
wcwidth==0.1.7
webencodings==0.5.1
websocket-client==0.54.0
Werkzeug==0.15.2
widgetsnbextension==3.3.0
wily==1.12.2
</code></pre></div>
<p>One line of the format <code>[package]==[version]</code>per requirement.</p>
<p>It can be installed via</p>
<div class="highlight"><pre><span></span><code>$ pip install -r requirements.txt
</code></pre></div>
<p>There are nice tools like <code>piprot</code> which tells you how outdated the
requirements are. I would not create a <code>requirements.txt</code> manually, but instead
a <code>setup.py</code> or a <code>requirements.in</code> and let <code>pip-compile</code> create the
<code>requirements.txt</code> with all the transitive dependencies. You can then also use
<code>pip-compile -U</code> to upgrade the dependencies.</p>
<h3 id="setuppy">setup.py</h3>
<p>I usually end up using something like the following:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>

<span class="sd">"""mpu: Martins Python Utilities."""</span>

<span class="c1"># Core Library</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Third party</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">find_packages</span><span class="p">,</span> <span class="n">setup</span>


<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="sd">"""Read a text file and return the content as a string."""</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">file_name</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>


<span class="n">requires_datetime</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"pytz"</span><span class="p">]</span>
<span class="n">requires_image</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Pillow"</span><span class="p">]</span>
<span class="n">requires_io</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"pytz"</span><span class="p">,</span> <span class="s2">"tzlocal"</span><span class="p">]</span>
<span class="n">requires_aws</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"boto3"</span><span class="p">]</span>
<span class="n">requires_tests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"pytest"</span><span class="p">,</span>
    <span class="s2">"pytest-cov"</span><span class="p">,</span>
    <span class="s2">"pytest-mccabe"</span><span class="p">,</span>
    <span class="s2">"pytest-flake8"</span><span class="p">,</span>
    <span class="s2">"simplejson"</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">requires_all</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">[</span><span class="s2">"pandas"</span><span class="p">,</span> <span class="s2">"python-magic"</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">requires_datetime</span>
    <span class="o">+</span> <span class="n">requires_image</span>
    <span class="o">+</span> <span class="n">requires_io</span>
    <span class="o">+</span> <span class="n">requires_aws</span>
    <span class="o">+</span> <span class="n">requires_tests</span>
<span class="p">)</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"mpu"</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">"0.21.0"</span><span class="p">,</span>  <span class="c1"># keep in sync with mpu/_version.py</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">"Martin Thoma"</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s2">"info@martin-thoma.de"</span><span class="p">,</span>
    <span class="n">maintainer</span><span class="o">=</span><span class="s2">"Martin Thoma"</span><span class="p">,</span>
    <span class="n">maintainer_email</span><span class="o">=</span><span class="s2">"info@martin-thoma.de"</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
    <span class="n">package_data</span><span class="o">=</span><span class="p">{</span><span class="s2">"mpu"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"units/currencies.csv"</span><span class="p">,</span> <span class="s2">"data/*"</span><span class="p">,</span> <span class="s2">"package/templates/*"</span><span class="p">]},</span>
    <span class="n">extras_require</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">"all"</span><span class="p">:</span> <span class="n">requires_all</span><span class="p">,</span>
        <span class="s2">"aws"</span><span class="p">:</span> <span class="n">requires_aws</span><span class="p">,</span>
        <span class="s2">"datetime"</span><span class="p">:</span> <span class="n">requires_datetime</span><span class="p">,</span>
        <span class="s2">"image"</span><span class="p">:</span> <span class="n">requires_image</span><span class="p">,</span>
        <span class="s2">"io"</span><span class="p">:</span> <span class="n">requires_io</span><span class="p">,</span>
        <span class="s2">"tests"</span><span class="p">:</span> <span class="n">requires_tests</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">platforms</span><span class="o">=</span><span class="p">[</span><span class="s2">"Linux"</span><span class="p">],</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">"https://github.com/MartinThoma/mpu"</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s2">"MIT"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"Martins Python Utilities"</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">read</span><span class="p">(</span><span class="s2">"README.md"</span><span class="p">),</span>
    <span class="n">long_description_content_type</span><span class="o">=</span><span class="s2">"text/markdown"</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">keywords</span><span class="o">=</span><span class="p">[</span><span class="s2">"utility"</span><span class="p">],</span>
    <span class="n">download_url</span><span class="o">=</span><span class="s2">"https://github.com/MartinThoma/mpu"</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">"Development Status :: 3 - Alpha"</span><span class="p">,</span>
        <span class="s2">"Environment :: Console"</span><span class="p">,</span>
        <span class="s2">"Intended Audience :: Developers"</span><span class="p">,</span>
        <span class="s2">"Intended Audience :: Information Technology"</span><span class="p">,</span>
        <span class="s2">"License :: OSI Approved :: MIT License"</span><span class="p">,</span>
        <span class="s2">"Natural Language :: English"</span><span class="p">,</span>
        <span class="s2">"Programming Language :: Python :: 3.6"</span><span class="p">,</span>
        <span class="s2">"Topic :: Software Development"</span><span class="p">,</span>
        <span class="s2">"Topic :: Utilities"</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="setupcfg">setup.cfg</h3>
<p>Instead of filling the <code>setup.py</code> that much, I like to move stuff to the <code>setup.cfg</code>. The reason for that is that I prefer to have configuration files instead of code, if it's possible.</p>
<p>Instead of the <code>setup.py</code> from above you can have this one:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">()</span>
</code></pre></div>
<p>and this <code>setup.cfg</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">[metadata]</span>
<span class="c1"># https://setuptools.readthedocs.io/en/latest/setuptools.html#configuring-setup-using-setup-cfg-files</span>
<span class="na">name</span> <span class="o">=</span> <span class="s">mpu</span>

<span class="na">author</span> <span class="o">=</span> <span class="s">Martin Thoma</span>
<span class="na">author_email</span> <span class="o">=</span> <span class="s">info@martin-thoma.de</span>
<span class="na">maintainer</span> <span class="o">=</span> <span class="s">Martin Thoma</span>
<span class="na">maintainer_email</span> <span class="o">=</span> <span class="s">info@martin-thoma.de</span>

<span class="c1"># keep in sync with mpu/_version.py</span>
<span class="na">version</span> <span class="o">=</span> <span class="s">0.21.0</span>

<span class="na">description</span> <span class="o">=</span> <span class="s">Martins Python Utilities</span>
<span class="na">long_description</span> <span class="o">=</span> <span class="s">file: README.md</span>
<span class="na">long_description_content_type</span> <span class="o">=</span> <span class="s">text/markdown</span>
<span class="na">keywords</span> <span class="o">=</span> <span class="s">utility,</span>

<span class="na">platforms</span> <span class="o">=</span> <span class="s">Linux</span>

<span class="na">url</span> <span class="o">=</span> <span class="s">https://github.com/MartinThoma/mpu</span>
<span class="na">download_url</span> <span class="o">=</span> <span class="s">https://github.com/MartinThoma/mpu</span>

<span class="na">license</span> <span class="o">=</span> <span class="s">MIT</span>
<span class="na">classifiers</span> <span class="o">=</span><span class="s"></span>
<span class="s">        Development Status :: 3 - Alpha</span>
<span class="s">        Environment :: Console</span>
<span class="s">        Intended Audience :: Developers</span>
<span class="s">        Intended Audience :: Information Technology</span>
<span class="s">        License :: OSI Approved :: MIT License</span>
<span class="s">        Natural Language :: English</span>
<span class="s">        Programming Language :: Python :: 3 :: Only</span>
<span class="s">        Programming Language :: Python :: 3.6</span>
<span class="s">        Programming Language :: Python :: 3.7</span>
<span class="s">        Programming Language :: Python :: 3.8</span>
<span class="s">        Topic :: Software Development</span>
<span class="s">        Topic :: Utilities</span>

<span class="k">[options]</span>
<span class="na">zip_safe</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">packages</span> <span class="o">=</span> <span class="s">find:</span>
<span class="na">python_requires</span> <span class="o">=</span> <span class="s">&gt;= 3.0</span>

<span class="k">[options.extras_require]</span>
<span class="na">all</span> <span class="o">=</span> <span class="s">pandas; python-magic; boto3; pytz; Pillow; tzlocal; pytest; pytest-cov; pytest-mccabe; pytest-flake8; simplejson</span>
<span class="na">aws</span> <span class="o">=</span> <span class="s">boto3</span>
<span class="na">datetime</span> <span class="o">=</span> <span class="s">pytz</span>
<span class="na">image</span> <span class="o">=</span> <span class="s">Pillow</span>
<span class="na">io</span> <span class="o">=</span> <span class="s">pytz; tzlocal</span>
<span class="na">test</span> <span class="o">=</span> <span class="s">pytest; pytest-cov; pytest-mccabe; pytest-flake8; simplejson</span>
</code></pre></div>
<p>You also see a reason here why you might want to mix-and-match between a pure <code>setup.py</code> and a pure <code>setup.cfg</code> solution: The <code>all</code> extra can be specified way better in code than in the configuration.</p>
<h3 id="pyprojecttoml">pyproject.toml</h3>
<p>The pyproject.toml deserves its <a href="https://martin-thoma.com/pyproject-toml/">own blog post</a>, but there are a few things to point out:</p>
<ul>
<li>Only the build system aspect is specified in <a href="https://www.python.org/dev/peps/pep-0518/">PEP 518</a></li>
<li><a href="https://python-poetry.org/docs/pyproject/">poetry defines</a> name, version, license, maintainers, readme, keywords, classifiers, dependencies and dependencies-dev, ...</li>
<li><a href="https://flit.readthedocs.io/en/latest/">flit defines</a> module, author, author-email, home-page, ...</li>
</ul>
<h2 id="tool-overview_1">Tool Overview</h2>
<p>Core Tools used by everybody:</p>
<ul>
<li><a href="https://pypi.org/project/pip/">pip</a>: Install and remove Python packages. Installing includes dependency resolution.</li>
<li><a href="https://pypi.org/project/twine/">twine</a>: Upload Python packages ("distributions")</li>
<li><a href="https://docs.python.org/3/library/venv.html">venv</a>: An application in the standard library that allows you to create virtual environments. I don't use this. Instead, I like to use <a href="https://pypi.org/project/tox/"><code>tox</code></a> to isolate my unit tests. Or just have them run in a CI pipeline.</li>
</ul>
<p>Third Party tools:</p>
<ul>
<li><a href="https://github.com/MartinThoma/cookiecutter-python-package">cookiecutter</a>: Create a package sceleton. I can recomend cookicutter, although it is just a tiny tool. I use it with <a href="https://github.com/MartinThoma/cookiecutter-python-package">my own template</a>.</li>
<li><a href="https://github.com/pyenv/pyenv">pyenv</a>: Manage different Python versions. I highly recommend to use it! Before, switching the Python version was a massive pain for me. After that, it just takes a minute to install a new version.</li>
<li><a href="https://github.com/pypa/pipenv">pipenv</a>: Manage virtual environments for us</li>
</ul>
<h2 id="comparison-with-other-languages">Comparison with other Languages</h2>
<p>The concept of abstract and concrete dependencies is not unique to Python and thus other programming languages have similar concepts. They look sometimes way less confusiong, e.g. because the language is new and could learn from existing patterns (e.g. Rust).</p>
<p>There are multiple ways to achieve the same thing in Python. For example, instead of using</p>
<table class="table">
<thead>
<tr>
<th>Language</th>
<th>Package Metadata</th>
<th>Abstract dependencies</th>
<th>Locked dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td>Python</td>
<td>setup.py<br/>setup.cfg</td>
<td><span style="color: green;">setup.py</span><br/><span style="color: green;">Pipfile</span><br/><span style="color: red;">requirements.txt</span></td>
<td><span style="color: green;">requirements.txt</span><br/><span style="color: green;">Pipfile.lock</span><br/><span style="color: red;">setup.py</span></td>
</tr>
<tr>
<td>Ruby</td>
<td>.gemspec</td>
<td>Gemfile</td>
<td>Gemfile.lock</td>
</tr>
<tr>
<td>Rust</td>
<td>Cargo.toml</td>
<td>Cargo.toml</td>
<td>Cargo.lock</td>
</tr>
</tbody>
</table>
<h2 id="glossary">Glossary</h2>
<p>The following is mostly taken from Wikipedia and <a href="https://docs.python.org/3/glossary.html">the Python glossary</a>:</p>
<dl>
<dt><a href="https://en.wikipedia.org/wiki/Namespace"><dfn>Namespace</dfn></a></dt>
<dd>The place where a variable is stored. A namespace ensures that all the identifiers within it have unique names so that they can be easily identified</dd>
<dt><a href="https://docs.python.org/3/tutorial/modules.html"><dfn>Module</dfn></a></dt>
<dd>An object that serves as an organizational unit of Python code. Modules have a namespace containing arbitrary Python objects. Modules are loaded into Python by the process of importing. A module is a <code>.py</code> file containing Python definitions and statements. The file name is the module name with the suffix .py appended. Within a module, the module&rsquo;s name (as a string) is available as the value of the global variable __name__</dd>
<dt><a href="https://docs.python.org/3/tutorial/modules.html#packages"><dfn>Package</dfn></a></dt>
<dd>A package is a folder with an <code>__init__.py</code> file. A package is a Python module with an <code>__path__</code> attribute.</dd>
<dt><dfn>Subpackage</dfn></dt>
<dd>If package B is contained in package A, then B is called a <dfn>subpackage</dfn> of A.</dd>
</dl>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="https://stackoverflow.com/q/25337706/562769">setuptools vs. distutils: why is distutils still a thing?</a></li>
<li><a href="https://medium.com/@joel.barmettler/how-to-upload-your-python-package-to-pypi-65edc5fe9c56">How to upload your python package to PyPi</a>, 07.05.2018.</li>
<li><a href="https://stackoverflow.com/q/46330327/562769">How are Pipfile and Pipfile.lock used?</a></li>
<li><a href="https://realpython.com/pipenv-guide/#dependency-management-with-requirementstxt">Pipenv: A Guide to the New Python Packaging Tool</a></li>
<li><a href="https://github.com/pypa/pipfile/issues/27#issuecomment-262264222">Comparison with Rust and Ruby</a>, 22.11.2016.</li>
<li><a href="https://github.com/jazzband/pip-tools/issues/679#issuecomment-418251444">Why to keep requirements.txt + pip-compile and not go to pipenv + Pipfile</a></li>
<li><a href="https://packaging.python.org/tutorials/managing-dependencies/#managing-dependencies">Managing Application Dependencies</a>: poetry, hatch, pip-tools</li>
<li><a href="https://blog.godatadriven.com/setup-py">A Practical Guide to Using Setup.py</a></li>
<li><a href="https://packaging.python.org/discussions/wheel-vs-egg/">Wheel vs Egg</a></li>
<li><a href="http://sedimental.org/the_packaging_gradient.html">The Many Layers of Packaging</a></li>
</ul>
            
            <div id="disqus_thread" class="no-print"></div>
<script>
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');

        s.src = '//martinthoma.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

            <hr/>
        </div>
        <section>
        <div class="col-sm-2 col-md-2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2020-05-16T20:00:00+02:00">Mai 16, 2020</time>
            <br/>
            by <a rel="author" class="vcard author post-author" itemprop="author" href="../author/martin-thoma/"><span class="fn" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name">Martin Thoma</span></span></a>
            <h4>Category</h4>
            <a class="category-link" href="../categories.html#code-ref">Code</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="../tags.html#python-ref">Python
                    <span>114</span>
</a></li>
                <li><a href="../tags.html#requirementstxt-ref">requirements.txt
                    <span>1</span>
</a></li>
                <li><a href="../tags.html#setuppy-ref">setup.py
                    <span>1</span>
</a></li>
                <li><a href="../tags.html#software-engineering-ref">Software Engineering
                    <span>13</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="https://twitter.com/themoosemind" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="mailto:info@martin-thoma.de" title="My Email Address" class="sidebar-social-links" target="_blank">
    <i class="fa fa-envelope sidebar-social-links"></i></a>
    <a href="https://github.com/MartinThoma" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="http://stackoverflow.com/users/562769/martin-thoma" title="My Stackoverflow Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-stackoverflow sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="col-sm-1 col-md-1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer class="no-print">
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-subtitle"><span class="site-name">Martin Thoma</span> - A blog about Code, the Web and Cyberculture</li>
        <li><a href="http://www.martin-thoma.de/privacy.htm">Datenschutzerkl&auml;rung</a></li>
        <li><a href="http://www.martin-thoma.de/impressum.htm">Impressum</a></li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>        <script src="//code.jquery.com/jquery.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script>
(function(){
    'use strict';

    /*
    Create intra-page links
    Requires that your headings already have an `id` attribute set (because that's what jekyll does)
    For every heading in your page, this adds a little anchor link `#` that you can click to get a permalink to the heading.
    Ignores `h1`, because you should only have one per page.
    The text content of the tag is used to generate the link, so it will fail "gracefully-ish" if you have duplicate heading text.

    Credit: https://gist.github.com/SimplGy/a229d25cdb19d7f21231
     */

    var headingNodes = [], results, link,
        tags = ['h2', 'h3', 'h4', 'h5', 'h6'];

    tags.forEach(function(tag){
        var contentTag = document.getElementById('contentAfterTitle');
      results = contentTag.getElementsByTagName(tag);
      Array.prototype.push.apply(headingNodes, results);
    });

    headingNodes.forEach(function(node){
      link = document.createElement('a');
      link.className = 'deepLink';
      link.textContent = ' ¶';
      link.href = '#' + node.getAttribute('id');
      node.appendChild(link);
    });

  })();
</script>
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>