<!DOCTYPE html>
<html lang="en">
  <!-- type: head.html -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    
    

    

    <meta property="og:type" content="blog"/>

    <title>Part II: The Strassen algorithm in Python, Java and C++</title>
    <link rel="stylesheet" href="http://martin-thoma.com/css/201407171418.min.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="http://martin-thoma.com/css/print.css" type="text/css" media="print" />
    <link rel="stylesheet" href="http://martin-thoma.com/css/handheld.css" type="text/css" media="only screen and (max-device-width: 480px)" />

    <link rel="alternate" type="application/rss+xml" title="Martin Thoma RSS Feed" href="http://martin-thoma.com/feed/" /><!--TODO-->
    <link rel="shortcut icon" href="http://martin-thoma.com/favicon.ico" type="image/x-icon" />

    <link rel="canonical" href="http://martin-thoma.com/strassen-algorithm-in-python-java-cpp" />
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:site" content="@themoosemind"/>
<meta name="twitter:creator" content="@themoosemind"/>
<meta name="twitter:title" content="Part II: The Strassen algorithm in Python, Java and C++"/>

    <meta name="twitter:description" content="A blog about Code, the Web and Cyberculture" />




<meta name="twitter:url" content="http://martin-thoma.com/strassen-algorithm-in-python-java-cpp"/>
<meta name="twitter:domain" content="Martin Thoma.com"/>


    <script type='text/javascript' src="http://martin-thoma.com/js/jquery.js"></script>
    <script type='text/javascript' src="http://martin-thoma.com/js/jquery-migrate.min.js"></script>
    <style type="text/css">div#toc_container {width: 275px;}</style>
    <style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<!-- type: post.html -->
<body>
	<div id="wrapper">
		<div id="container" class="container">
			<div class="span-16">
                <!-- type: header.html -->
<div id="header" role="banner">
    <h1><a href="http://martin-thoma.com">Martin Thoma</a></h1>
    <h2>A blog about Code, the Web and Cyberculture.</h2>
</div>
<nav class="navcontainer" role="navigation">
	<ul id="nav">
		<li class=""><a href="http://martin-thoma.com">Home</a></li>
		<li class="page_item page-item-41 "><a href="http://martin-thoma.com/author/martin-thoma/">About Me</a></li>
        <li class="page_item page-item-91 "><a href="http://martin-thoma.com/imprint/">Imprint</a></li>
	</ul>
</nav>

            	<div id="content">	
                    <article class="post type-post format-standard hentry clearfix ">
                        <h2 class="title entry-title">Part II: The Strassen algorithm in Python, Java and C++</h2>
			            <div class="postdate entry-date">
                            <time datetime="2013-01-23T04:35:55-05:00">
                                January 
                                23rd,
                                  
                                2013
                            </time>
                        </div>
			
						<div class="entry">
                            <div class="info">This is Part II of my matrix multiplication series. <a href="../matrix-multiplication-python-java-cpp/">Part I</a> was about simple matrix multiplication algorithms and <a href="../strassen-algorithm-in-python-java-cpp/">Part II</a> was about the Strassen algorithm.
<a href="../part-iii-matrix-multiplication-on-multiple-cores-in-python-java-and-c/">Part III</a> is about parallel matrix multiplication.</div>

<p>The usual matrix multiplication of two $n \times n$ matrices has a time-complexity of $\mathcal{O}(n^3)$. This means, if $n$ doubles, the time for the computation increases by a factor of 8. But you don't have to use that much resources. The <a href="http://en.wikipedia.org/wiki/Strassen_algorithm">Strassen algorithm</a> has a time complexity of $\mathcal O(n^{log_2(7)+o(1)}) \approx \cal O(n^{2.807})$. The idea is similar to the <a href="http://en.wikipedia.org/wiki/Karatsuba_algorithm">Karatsuba algorithm</a> for simple multiplication. Basically, you make a tradeof: Instead of one multiplication, you use many additions. As additions are - at least for humans - easier, you might rather like to use many additions. Lets see how the Strassen algortihms execution time compares to the other execution times in Part I. As last time, I'll multiply two $2000 \times 2000$ matrices that have to be read from a file. Everything - reading, calculation and writing the result - counts to the execution time.</p>

<div id="toc_container" class="toc_light_blue no_bullets">
   <p class="toc_title">Contents</p>
   <ul class="toc_list">
      <li class="toc_level-1 toc_section-1">
         <a href="#tocAnchor-1-1"><span class="tocnumber">1</span> <span class="toctext">The implementations</span></a>
      </li>
      <li class="toc_level-1 toc_section-2">
         <a href="#tocAnchor-1-2"><span class="tocnumber">2</span> <span class="toctext">Tests and Setting</span></a>
      </li>
      <li class="toc_level-1 toc_section-3">
         <a href="#tocAnchor-1-3"><span class="tocnumber">3</span> <span class="toctext">Python</span></a>
      </li>
      <li class="toc_level-1 toc_section-4">
         <a href="#tocAnchor-1-4"><span class="tocnumber">4</span> <span class="toctext">Java</span></a>
      </li>
      <li class="toc_level-1 toc_section-5">
         <a href="#tocAnchor-1-5"><span class="tocnumber">5</span> <span class="toctext">C++</span></a>
      </li>
      <li class="toc_level-1 toc_section-6">
         <a href="#tocAnchor-1-6"><span class="tocnumber">6</span> <span class="toctext">Conclusion</span></a>
      </li>
   </ul>
</div><h2 id="tocAnchor-1-1">The implementations</h2>

<p>As last time, I've added the scripts to a <a href="https://github.com/MartinThoma/matrix-multiplication">GIT repository</a>, so feel free to test it on your machine. I will use the  I am also happy if you post some of your solutions with running times :-)
If you know other languages, you could create a script for these. I focus on Python, Java and C++.</p>

<p>I have implemented only the Strassen algorithm for this post. Please take a look at Wikipedia for a detailed explanation how this algorithm works. The important idea of the algorithm is that you break both matrices into four $\frac{n}{2} \times \frac{n}{2}$ matrices and multiply them in a clever way. Note that you can also use the Strassen algorithm recursively for those $\frac{n}{2} \times \frac{n}{2}$ matrices. You can do this until you have $1 \times 1$ matrices which are simple numbers. But it does make sense to stop this recursion and use the <a href="../matrix-multiplication-python-java-cpp/#ikj-algorithm">ikj-algorithm</a> as soon as the matrices are small enough. But what exactly is "small enough"? I'll test that. The size when you use the ikj-algorithm is called <code>LEAF_SIZE</code> in my scripts. Note that only leaf sizes of multiples of two matter as the size of the (sub-)matrices that get passed to strassenR are multiples of two.</p>

<p>If you post a solution, please consider these restrictions:
</p><ul>
    <li><strong>Input</strong>: 
    <ul>
      <li>The input file should get passed with the parameter <code>-i</code>, e.g.: 
    <code>python -i bigMatrix.in</code> or <code>java Shell -i bigMatrix.in</code></li>
      <li>The leaf-size should get passed with <code>-l</code>, e.g.: 
    <code>python -i bigMatrix.in -l 32</code></li>
    </ul>
    </li>
    <li>The standard value for the command line parameter -i should be "bigMatrix.in"</li>
    <li>The user should <em>not</em> have to give the size of the matrix!</li>
    <li>The two square-matrices that should get multiplied are ...
    <ul>
    <li>... read from a text-file.</li>
    <li>... represented like this:
        <ul>
        <li>Every line of one matrix is one line in the text-file.</li>
        <li>Newlines are only "\n".</li>
        <li>Every number is separated by "\t".</li>
        <li>The both matrices are separated by one newline.</li>
        </ul>
    </li>
    </ul>
    </li>
    <li><strong>Output</strong>: The result has to get printed to standard output.</li>
    <li>The result has to be formatted like the input (tabs for separation of number, \n for marks a new line)</li>
</ul>

<h2 id="tocAnchor-1-2">Tests and Setting</h2>

<p><a href="../matrix-multiplication-python-java-cpp/#The_Tests">Tests and setting</a> are the same as in the first part.</p>

<h2 id="tocAnchor-1-3">Python</h2>

<p>Iâ€™ve used Python 2.6.5.</p>

<div class="highlight">
   <pre><code class="python"><span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">log</span>

<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">A</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="s">""</span><span class="p">:</span>
            <span class="n">matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">B</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span>

<span class="k">def</span> <span class="nf">printMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">line</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">ikjMatrixProduct</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">C</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">C</span>

<span class="k">def</span> <span class="nf">subtract</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">C</span>

<span class="k">def</span> <span class="nf">strassenR</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">""" </span>
<span class="sd">        Implementation of the strassen algorithm.</span>
<span class="sd">    """</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">LEAF_SIZE</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ikjMatrixProduct</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># initializing the new sub-matrices</span>
        <span class="n">newSize</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">a11</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>
        <span class="n">a12</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>
        <span class="n">a21</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>
        <span class="n">a22</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>

        <span class="n">b11</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>
        <span class="n">b12</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>
        <span class="n">b21</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>
        <span class="n">b22</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>

        <span class="n">aResult</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">)]</span>

        <span class="c"># dividing the matrices in 4 sub-matrices:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">):</span>
                <span class="n">a11</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>            <span class="c"># top left</span>
                <span class="n">a12</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">]</span>    <span class="c"># top right</span>
                <span class="n">a21</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>    <span class="c"># bottom left</span>
                <span class="n">a22</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">]</span> <span class="c"># bottom right</span>
 
                <span class="n">b11</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>            <span class="c"># top left</span>
                <span class="n">b12</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">]</span>    <span class="c"># top right</span>
                <span class="n">b21</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>    <span class="c"># bottom left</span>
                <span class="n">b22</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">]</span> <span class="c"># bottom right</span>

        <span class="c"># Calculating p1 to p7:</span>
        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">a11</span><span class="p">,</span> <span class="n">a22</span><span class="p">)</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">b11</span><span class="p">,</span> <span class="n">b22</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">bResult</span><span class="p">)</span> <span class="c"># p1 = (a11+a22) * (b11+b22)</span>
 
        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">)</span>      <span class="c"># a21 + a22</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">b11</span><span class="p">)</span>  <span class="c"># p2 = (a21+a22) * (b11)</span>
 
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">b12</span><span class="p">,</span> <span class="n">b22</span><span class="p">)</span> <span class="c"># b12 - b22</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">strassenR</span><span class="p">(</span><span class="n">a11</span><span class="p">,</span> <span class="n">bResult</span><span class="p">)</span>  <span class="c"># p3 = (a11) * (b12 - b22)</span>
 
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">b21</span><span class="p">,</span> <span class="n">b11</span><span class="p">)</span> <span class="c"># b21 - b11</span>
        <span class="n">p4</span> <span class="o">=</span><span class="n">strassenR</span><span class="p">(</span><span class="n">a22</span><span class="p">,</span> <span class="n">bResult</span><span class="p">)</span>   <span class="c"># p4 = (a22) * (b21 - b11)</span>
 
        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">)</span>      <span class="c"># a11 + a12</span>
        <span class="n">p5</span> <span class="o">=</span> <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">b22</span><span class="p">)</span>  <span class="c"># p5 = (a11+a12) * (b22)   </span>
 
        <span class="n">aResult</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">a21</span><span class="p">,</span> <span class="n">a11</span><span class="p">)</span> <span class="c"># a21 - a11</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">b11</span><span class="p">,</span> <span class="n">b12</span><span class="p">)</span>      <span class="c"># b11 + b12</span>
        <span class="n">p6</span> <span class="o">=</span> <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">bResult</span><span class="p">)</span> <span class="c"># p6 = (a21-a11) * (b11+b12)</span>
 
        <span class="n">aResult</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">a12</span><span class="p">,</span> <span class="n">a22</span><span class="p">)</span> <span class="c"># a12 - a22</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">b21</span><span class="p">,</span> <span class="n">b22</span><span class="p">)</span>      <span class="c"># b21 + b22</span>
        <span class="n">p7</span> <span class="o">=</span> <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">bResult</span><span class="p">)</span> <span class="c"># p7 = (a12-a22) * (b21+b22)</span>

        <span class="c"># calculating c21, c21, c11 e c22:</span>
        <span class="n">c12</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p5</span><span class="p">)</span> <span class="c"># c12 = p3 + p5</span>
        <span class="n">c21</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span>  <span class="c"># c21 = p2 + p4</span>
 
        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span> <span class="c"># p1 + p4</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">p7</span><span class="p">)</span> <span class="c"># p1 + p4 + p7</span>
        <span class="n">c11</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">bResult</span><span class="p">,</span> <span class="n">p5</span><span class="p">)</span> <span class="c"># c11 = p1 + p4 - p5 + p7</span>
 
        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span> <span class="c"># p1 + p3</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">p6</span><span class="p">)</span> <span class="c"># p1 + p3 + p6</span>
        <span class="n">c22</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">bResult</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> <span class="c"># c22 = p1 + p3 - p2 + p6</span>
 
        <span class="c"># Grouping the results obtained in a single matrix:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newSize</span><span class="p">):</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">c12</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">c21</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">c22</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">C</span>

<span class="k">def</span> <span class="nf">strassen</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c"># Make the matrices bigger so that you can apply the strassen</span>
    <span class="c"># algorithm recursively without having to deal with odd</span>
    <span class="c"># matrix sizes</span>
    <span class="n">nextPowerOfTwo</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="mi">2</span><span class="o">**</span><span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">nextPowerOfTwo</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">APrep</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
    <span class="n">BPrep</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">APrep</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">BPrep</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
    <span class="n">CPrep</span> <span class="o">=</span> <span class="n">strassenR</span><span class="p">(</span><span class="n">APrep</span><span class="p">,</span> <span class="n">BPrep</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">CPrep</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">C</span>
    
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">"-i"</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">"filename"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"2000.in"</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s">"input file with two matrices"</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">"FILE"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">"-l"</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">"LEAF_SIZE"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"8"</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s">"when do you start using ikj"</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">"LEAF_SIZE"</span><span class="p">)</span>
    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">LEAF_SIZE</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">LEAF_SIZE</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">strassen</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
    <span class="n">printMatrix</span><span class="p">(</span><span class="n">C</span><span class="p">)</span></code></pre>
</div>

<p>The execution-times were the same as with the ikj-algorithm, no matter what the leaf size was:</p>

<div class="highlight">
   <pre><code class="bash">ikj-algorithm    44m13.458s
LEAF_SIZE   Time
2   47m45.983s
8   47m41.311s
16  48m5.472s
32  48m5.624s
64  47m55.076s</code></pre>
</div>

<h2 id="tocAnchor-1-4">Java</h2>

<p>The Java-code is a little bit long and has three classes. I'll only past the important methods. If you're interested in a full, working example, please look at <a href="https://github.com/MartinThoma/matrix-multiplication/tree/master/Java">GitHub</a>.</p>

<div class="highlight">
   <pre><code class="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[][]</span> <span class="nf">ikjAlgorithm</span><span class="o">(</span><span class="kt">int</span><span class="o">[][]</span> <span class="n">A</span><span class="o">,</span> <span class="kt">int</span><span class="o">[][]</span> <span class="n">B</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>

    <span class="c1">// initialise C</span>
    <span class="kt">int</span><span class="o">[][]</span> <span class="n">C</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">n</span><span class="o">];</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">k</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">C</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">+=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">k</span><span class="o">]</span> <span class="o">*</span> <span class="n">B</span><span class="o">[</span><span class="n">k</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">C</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[][]</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span><span class="o">[][]</span> <span class="n">A</span><span class="o">,</span> <span class="kt">int</span><span class="o">[][]</span> <span class="n">B</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="kt">int</span><span class="o">[][]</span> <span class="n">C</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">n</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">C</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">+</span> <span class="n">B</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">C</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[][]</span> <span class="nf">subtract</span><span class="o">(</span><span class="kt">int</span><span class="o">[][]</span> <span class="n">A</span><span class="o">,</span> <span class="kt">int</span><span class="o">[][]</span> <span class="n">B</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="kt">int</span><span class="o">[][]</span> <span class="n">C</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">n</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">C</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">-</span> <span class="n">B</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">C</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">nextPowerOfTwo</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">log2</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">/</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
    <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">log2</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[][]</span> <span class="nf">strassen</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">A</span><span class="o">,</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Make the matrices bigger so that you can apply the strassen</span>
    <span class="c1">// algorithm recursively without having to deal with odd</span>
    <span class="c1">// matrix sizes</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">nextPowerOfTwo</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
    <span class="kt">int</span><span class="o">[][]</span> <span class="n">APrep</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">m</span><span class="o">][</span><span class="n">m</span><span class="o">];</span>
    <span class="kt">int</span><span class="o">[][]</span> <span class="n">BPrep</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">m</span><span class="o">][</span><span class="n">m</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">APrep</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
            <span class="n">BPrep</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kt">int</span><span class="o">[][]</span> <span class="n">CPrep</span> <span class="o">=</span> <span class="n">strassenR</span><span class="o">(</span><span class="n">APrep</span><span class="o">,</span> <span class="n">BPrep</span><span class="o">);</span>
    <span class="kt">int</span><span class="o">[][]</span> <span class="n">C</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">n</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">C</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">CPrep</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">C</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[][]</span> <span class="nf">strassenR</span><span class="o">(</span><span class="kt">int</span><span class="o">[][]</span> <span class="n">A</span><span class="o">,</span> <span class="kt">int</span><span class="o">[][]</span> <span class="n">B</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">LEAF_SIZE</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">ikjAlgorithm</span><span class="o">(</span><span class="n">A</span><span class="o">,</span> <span class="n">B</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// initializing the new sub-matrices</span>
        <span class="kt">int</span> <span class="n">newSize</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">a11</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">a12</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">a21</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">a22</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>

        <span class="kt">int</span><span class="o">[][]</span> <span class="n">b11</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">b12</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">b21</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">b22</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>

        <span class="kt">int</span><span class="o">[][]</span> <span class="n">aResult</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">bResult</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">newSize</span><span class="o">][</span><span class="n">newSize</span><span class="o">];</span>

        <span class="c1">// dividing the matrices in 4 sub-matrices:</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">newSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">newSize</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">a11</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span> <span class="c1">// top left</span>
                <span class="n">a12</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">];</span> <span class="c1">// top right</span>
                <span class="n">a21</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">][</span><span class="n">j</span><span class="o">];</span> <span class="c1">// bottom left</span>
                <span class="n">a22</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">];</span> <span class="c1">// bottom right</span>

                <span class="n">b11</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">B</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span> <span class="c1">// top left</span>
                <span class="n">b12</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">B</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">];</span> <span class="c1">// top right</span>
                <span class="n">b21</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">B</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">][</span><span class="n">j</span><span class="o">];</span> <span class="c1">// bottom left</span>
                <span class="n">b22</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">B</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">];</span> <span class="c1">// bottom right</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// Calculating p1 to p7:</span>
        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">a11</span><span class="o">,</span> <span class="n">a22</span><span class="o">);</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">b11</span><span class="o">,</span> <span class="n">b22</span><span class="o">);</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">strassenR</span><span class="o">(</span><span class="n">aResult</span><span class="o">,</span> <span class="n">bResult</span><span class="o">);</span>
        <span class="c1">// p1 = (a11+a22) * (b11+b22)</span>

        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">a21</span><span class="o">,</span> <span class="n">a22</span><span class="o">);</span> <span class="c1">// a21 + a22</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">strassenR</span><span class="o">(</span><span class="n">aResult</span><span class="o">,</span> <span class="n">b11</span><span class="o">);</span> <span class="c1">// p2 = (a21+a22) * (b11)</span>

        <span class="n">bResult</span> <span class="o">=</span> <span class="n">subtract</span><span class="o">(</span><span class="n">b12</span><span class="o">,</span> <span class="n">b22</span><span class="o">);</span> <span class="c1">// b12 - b22</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">strassenR</span><span class="o">(</span><span class="n">a11</span><span class="o">,</span> <span class="n">bResult</span><span class="o">);</span>
        <span class="c1">// p3 = (a11) * (b12 - b22)</span>

        <span class="n">bResult</span> <span class="o">=</span> <span class="n">subtract</span><span class="o">(</span><span class="n">b21</span><span class="o">,</span> <span class="n">b11</span><span class="o">);</span> <span class="c1">// b21 - b11</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">strassenR</span><span class="o">(</span><span class="n">a22</span><span class="o">,</span> <span class="n">bResult</span><span class="o">);</span>
        <span class="c1">// p4 = (a22) * (b21 - b11)</span>

        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">a11</span><span class="o">,</span> <span class="n">a12</span><span class="o">);</span> <span class="c1">// a11 + a12</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">p5</span> <span class="o">=</span> <span class="n">strassenR</span><span class="o">(</span><span class="n">aResult</span><span class="o">,</span> <span class="n">b22</span><span class="o">);</span>
        <span class="c1">// p5 = (a11+a12) * (b22)</span>

        <span class="n">aResult</span> <span class="o">=</span> <span class="n">subtract</span><span class="o">(</span><span class="n">a21</span><span class="o">,</span> <span class="n">a11</span><span class="o">);</span> <span class="c1">// a21 - a11</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">b11</span><span class="o">,</span> <span class="n">b12</span><span class="o">);</span> <span class="c1">// b11 + b12</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">p6</span> <span class="o">=</span> <span class="n">strassenR</span><span class="o">(</span><span class="n">aResult</span><span class="o">,</span> <span class="n">bResult</span><span class="o">);</span>
        <span class="c1">// p6 = (a21-a11) * (b11+b12)</span>

        <span class="n">aResult</span> <span class="o">=</span> <span class="n">subtract</span><span class="o">(</span><span class="n">a12</span><span class="o">,</span> <span class="n">a22</span><span class="o">);</span> <span class="c1">// a12 - a22</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">b21</span><span class="o">,</span> <span class="n">b22</span><span class="o">);</span> <span class="c1">// b21 + b22</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">p7</span> <span class="o">=</span> <span class="n">strassenR</span><span class="o">(</span><span class="n">aResult</span><span class="o">,</span> <span class="n">bResult</span><span class="o">);</span>
        <span class="c1">// p7 = (a12-a22) * (b21+b22)</span>

        <span class="c1">// calculating c21, c21, c11 e c22:</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">c12</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">p3</span><span class="o">,</span> <span class="n">p5</span><span class="o">);</span> <span class="c1">// c12 = p3 + p5</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">c21</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">p2</span><span class="o">,</span> <span class="n">p4</span><span class="o">);</span> <span class="c1">// c21 = p2 + p4</span>

        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">p1</span><span class="o">,</span> <span class="n">p4</span><span class="o">);</span> <span class="c1">// p1 + p4</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">aResult</span><span class="o">,</span> <span class="n">p7</span><span class="o">);</span> <span class="c1">// p1 + p4 + p7</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">c11</span> <span class="o">=</span> <span class="n">subtract</span><span class="o">(</span><span class="n">bResult</span><span class="o">,</span> <span class="n">p5</span><span class="o">);</span>
        <span class="c1">// c11 = p1 + p4 - p5 + p7</span>

        <span class="n">aResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">p1</span><span class="o">,</span> <span class="n">p3</span><span class="o">);</span> <span class="c1">// p1 + p3</span>
        <span class="n">bResult</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">aResult</span><span class="o">,</span> <span class="n">p6</span><span class="o">);</span> <span class="c1">// p1 + p3 + p6</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">c22</span> <span class="o">=</span> <span class="n">subtract</span><span class="o">(</span><span class="n">bResult</span><span class="o">,</span> <span class="n">p2</span><span class="o">);</span>
        <span class="c1">// c22 = p1 + p3 - p2 + p6</span>

        <span class="c1">// Grouping the results obtained in a single matrix:</span>
        <span class="kt">int</span><span class="o">[][]</span> <span class="n">C</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">n</span><span class="o">];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">newSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">newSize</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">C</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">c11</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
                <span class="n">C</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">]</span> <span class="o">=</span> <span class="n">c12</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
                <span class="n">C</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">c21</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
                <span class="n">C</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newSize</span><span class="o">]</span> <span class="o">=</span> <span class="n">c22</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">C</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>

<p>Here are the results for different leaf-sizes:
</p><div style="width: 510px" class="wp-caption aligncenter">
   <a href="../images/2013/01/bchart-simple.png">
      <img src="../images/2013/01/bchart-simple.png" alt="Matrix multiplication with Java: Execution time in seconds for different leafsizes" width="" height="" class="size-full wp-image-54901" />
   </a>
   <p class="wp-caption-text">Matrix multiplication with Java: Execution time in seconds for different leafsizes</p>
</div>

<h2 id="tocAnchor-1-5">C++</h2>

<div class="highlight">
   <pre><code class="cpp"><span class="cp">#include &lt;sstream&gt;</span>
<span class="cp">#include &lt;string&gt;</span>
<span class="cp">#include &lt;fstream&gt;</span>
<span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>
<span class="cp">#include &lt;cmath&gt;</span>

<span class="c1">// Set LEAF_SIZE to 1 if you want to the pure strassen algorithm</span>
<span class="c1">// otherwise, the ikj-algorithm will be applied when the split</span>
<span class="c1">// matrices are as small as LEAF_SIZE x LEAF_SIZE</span>
<span class="kt">int</span> <span class="n">leafsize</span><span class="p">;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Implementation of the strassen algorithm, similar to </span>
<span class="cm"> * http://en.wikipedia.org/w/index.php?title=Strassen_algorithm&amp;oldid=498910018#Source_code_of_the_Strassen_algorithm_in_C_language</span>
<span class="cm"> */</span>
 
<span class="kt">void</span> <span class="nf">strassen</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tam</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">nextPowerOfTwo</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">strassenR</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> 
              <span class="kt">int</span> <span class="n">tam</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">sum</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> 
         <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> 
         <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tam</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">subtract</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tam</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">printMatrix</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matrix</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">read</span><span class="p">(</span><span class="n">string</span> <span class="n">filename</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">ikjalgorithm</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">,</span> 
                                   <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">B</span><span class="p">,</span>
                                   <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">strassenR</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tam</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tam</span> <span class="o">&lt;=</span> <span class="n">leafsize</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ikjalgorithm</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">tam</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="c1">// other cases are treated here:</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">newTam</span> <span class="o">=</span> <span class="n">tam</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">inner</span> <span class="p">(</span><span class="n">newTam</span><span class="p">);</span>
        <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> 
            <span class="n">a11</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">a12</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">a21</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">a22</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span>
            <span class="n">b11</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">b12</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">b21</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">b22</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span>
              <span class="n">c11</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">c12</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">c21</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">c22</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span>
            <span class="n">p1</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">p2</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">p3</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">p4</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> 
            <span class="n">p5</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">p6</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">p7</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span>
            <span class="n">aResult</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">),</span> <span class="n">bResult</span><span class="p">(</span><span class="n">newTam</span><span class="p">,</span><span class="n">inner</span><span class="p">);</span>
 
        <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
 
        <span class="c1">//dividing the matrices in 4 sub-matrices:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">newTam</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">newTam</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">a11</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
                <span class="n">a12</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">];</span>
                <span class="n">a21</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
                <span class="n">a22</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">];</span>
 
                <span class="n">b11</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
                <span class="n">b12</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">];</span>
                <span class="n">b21</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
                <span class="n">b22</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
 
        <span class="c1">// Calculating p1 to p7:</span>
 
        <span class="n">sum</span><span class="p">(</span><span class="n">a11</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">aResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// a11 + a22</span>
        <span class="n">sum</span><span class="p">(</span><span class="n">b11</span><span class="p">,</span> <span class="n">b22</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// b11 + b22</span>
        <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p1 = (a11+a22) * (b11+b22)</span>
 
        <span class="n">sum</span><span class="p">(</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">aResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// a21 + a22</span>
        <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">b11</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p2 = (a21+a22) * (b11)</span>
 
        <span class="n">subtract</span><span class="p">(</span><span class="n">b12</span><span class="p">,</span> <span class="n">b22</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// b12 - b22</span>
        <span class="n">strassenR</span><span class="p">(</span><span class="n">a11</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p3 = (a11) * (b12 - b22)</span>
 
        <span class="n">subtract</span><span class="p">(</span><span class="n">b21</span><span class="p">,</span> <span class="n">b11</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// b21 - b11</span>
        <span class="n">strassenR</span><span class="p">(</span><span class="n">a22</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p4 = (a22) * (b21 - b11)</span>
 
        <span class="n">sum</span><span class="p">(</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">aResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// a11 + a12</span>
        <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">b22</span><span class="p">,</span> <span class="n">p5</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p5 = (a11+a12) * (b22)   </span>
 
        <span class="n">subtract</span><span class="p">(</span><span class="n">a21</span><span class="p">,</span> <span class="n">a11</span><span class="p">,</span> <span class="n">aResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// a21 - a11</span>
        <span class="n">sum</span><span class="p">(</span><span class="n">b11</span><span class="p">,</span> <span class="n">b12</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// b11 + b12</span>
        <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">p6</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p6 = (a21-a11) * (b11+b12)</span>
 
        <span class="n">subtract</span><span class="p">(</span><span class="n">a12</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">aResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// a12 - a22</span>
        <span class="n">sum</span><span class="p">(</span><span class="n">b21</span><span class="p">,</span> <span class="n">b22</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// b21 + b22</span>
        <span class="n">strassenR</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">p7</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p7 = (a12-a22) * (b21+b22)</span>
 
        <span class="c1">// calculating c21, c21, c11 e c22:</span>
 
        <span class="n">sum</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p5</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// c12 = p3 + p5</span>
        <span class="n">sum</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">c21</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// c21 = p2 + p4</span>
 
        <span class="n">sum</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">aResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p1 + p4</span>
        <span class="n">sum</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">p7</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p1 + p4 + p7</span>
        <span class="n">subtract</span><span class="p">(</span><span class="n">bResult</span><span class="p">,</span> <span class="n">p5</span><span class="p">,</span> <span class="n">c11</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// c11 = p1 + p4 - p5 + p7</span>
 
        <span class="n">sum</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">aResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p1 + p3</span>
        <span class="n">sum</span><span class="p">(</span><span class="n">aResult</span><span class="p">,</span> <span class="n">p6</span><span class="p">,</span> <span class="n">bResult</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// p1 + p3 + p6</span>
        <span class="n">subtract</span><span class="p">(</span><span class="n">bResult</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">c22</span><span class="p">,</span> <span class="n">newTam</span><span class="p">);</span> <span class="c1">// c22 = p1 + p3 - p2 + p6</span>
 
        <span class="c1">// Grouping the results obtained in a single matrix:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">newTam</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">newTam</span> <span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">c11</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">]</span> <span class="o">=</span> <span class="n">c12</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">c21</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">newTam</span><span class="p">]</span> <span class="o">=</span> <span class="n">c22</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">nextPowerOfTwo</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">))));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">strassen</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//unsigned int n = tam;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">nextPowerOfTwo</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">inner</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">APrep</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">inner</span><span class="p">),</span> <span class="n">BPrep</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">inner</span><span class="p">),</span> <span class="n">CPrep</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">inner</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">APrep</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="n">BPrep</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">strassenR</span><span class="p">(</span><span class="n">APrep</span><span class="p">,</span> <span class="n">BPrep</span><span class="p">,</span> <span class="n">CPrep</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">CPrep</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sum</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> 
         <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> 
         <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tam</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
 
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tam</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">tam</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">subtract</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> 
              <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tam</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
 
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tam</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">tam</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>   
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">getMatrixSize</span><span class="p">(</span><span class="n">string</span> <span class="n">filename</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">line</span><span class="p">;</span>
    <span class="n">ifstream</span> <span class="n">infile</span><span class="p">;</span>
    <span class="n">infile</span><span class="p">.</span><span class="n">open</span> <span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">getline</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">count</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">line</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="sc">'\t'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">read</span><span class="p">(</span><span class="n">string</span> <span class="n">filename</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">line</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">matrixfile</span> <span class="o">=</span> <span class="n">freopen</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="s">"r"</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">matrixfile</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Could not read file "</span> <span class="o">&lt;&lt;</span> <span class="n">filename</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">a</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">line</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">istringstream</span> <span class="n">iss</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">iss</span> <span class="o">&gt;&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">istringstream</span> <span class="n">iss</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">iss</span> <span class="o">&gt;&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">fclose</span> <span class="p">(</span><span class="n">matrixfile</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">printMatrix</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matrix</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">filename</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s">"2000.in"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">leafsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">leafsize</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">getMatrixSize</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">inner</span> <span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inner</span><span class="p">),</span> <span class="n">B</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inner</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inner</span><span class="p">);</span>
    <span class="n">read</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
    <span class="n">strassen</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="n">printMatrix</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>

<p>For C++, you get those user-times for the different leaf-sizes:
</p><div style="width: 510px" class="wp-caption aligncenter">
   <a href="../images/2013/01/cpp-leaf-size-times.png">
      <img src="../images/2013/01/cpp-leaf-size-times.png" alt="Execution times in seconds with differen leafsizes with C++" width="" height="" class="size-full wp-image-54921" />
   </a>
   <p class="wp-caption-text">Execution times in seconds with differen leafsizes with C++</p>
</div>

<h2 id="tocAnchor-1-6">Conclusion</h2>

<p>As always, C++ is the fastest solution. </p>

<p>I am a little bit surprised, that the LEAF_SIZE doesn't matter for Python. I think I have used some very slow operations that are much more important than any speed gains or losses due to LEAF_SIZE. I guess the list creation might be slow. Does anybody know a tool for performance analysis of Python programs? This tool should be able to track which pieces of code got executed most often any preferably visualize it.</p>

<p>For Java and C++, the Strassen algorithm had better execution times than the ikj-algorithm and it was also better than any library that I could find. The reasons why librarys perform worse than my implementation might be that pure integer matrices are rather rare. Usually you have double-matrices. Maybe you use different algorithms to keep rounding errors as small as possible (Can anybody provide more information to my speculations?)</p>

<p>Leafsizes from 64 to 256 seem to be the best solution.</p>

						</div>
						<div class="postmeta">Posted in 
                            
                                <a href="http://martin-thoma.com/category/code/">code</a><!--TODO: Displayed category name should be upper case! -->
                             | Tags: 
                            
                                
                                    <a href="http://martin-thoma.com/tag/python/">Python</a>
                                
                            
                                , <a href="http://martin-thoma.com/tag/c/">C</a>
                                
                            
                                , <a href="http://martin-thoma.com/tag/java/">Java</a>
                                
                            
                                , <a href="http://martin-thoma.com/tag/strassen-algorithm/">Strassen algorithm</a>
                                
                            
                                , <a href="http://martin-thoma.com/tag/matrix-multiplication/">matrix multiplication</a>
                                
                             by <a rel="author" class="vcard author" href="http://martin-thoma.com/author/martin-thoma/"><span class="fn">Martin Thoma</span></a> on <span class="updated"><span class="value-title" title="2013-01-23 04:35:55 -0500">
                                January 
                                23rd
                                  , 
                                2013</span></span></div>

							<div class="navigation clearfix">
                                <div class="alignleft">
                                
                                    &laquo; <a href="http://martin-thoma.com/check-x-in-a-row-for-board-games/" rel="prev">Check x-in-a-row for board games</a>
                                 
                                </div>
								<div class="alignright">
                                
                                    <a href="http://martin-thoma.com/software-licenses/" rel="next">Software Licenses</a> &raquo;
                                 
                                </div>
							</div>
	
						</article>
                        <div id="respond">
                            <h3>Leave a Reply</h3>
                                <!-- comment discuss code -->
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'martinthoma'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <!-- comment discuss code -->

                        </div>
                    </div>
			    </div>
            <div class="span-8 last">
                <div id="subscriptions">
<a href="http://martin-thoma.com/feed/"><img src="http://martin-thoma.com/css/images/rss.png" alt="Subscribe to RSS Feed" title="Subscribe to RSS Feed" width="72" height="47" /></a>		
<a href="https://twitter.com/#!/themoosemind" title="Follow me on Twitter!"><img src="http://martin-thoma.com/css/images/twitter.png" title="Follow me on Twitter!" alt="Follow me on Twitter!"  width="76" height="47" /></a>
</div>

	            <div id="sidebar">
                <!-- type: searchbox.html - TODO-->
<ul>
    <li id="search">
        <div class="searchlayout">
            <form method="get" id="searchform" action="http://google.com/cse" role="search">
                <input type="hidden" name="cx" value="017345337424948206369:qrnnnentkkk" />
                <input type="search" value="" name="q" id="s" placeholder="Search with Google"/>
                <input type="image" src="http://martin-thoma.com/css/images/search.gif" style="border:0; vertical-align: top;" alt="search"/> 
            </form>
        </div>
    </li>
</ul>

                <div class="addthis_toolbox">   
    <div class="custom_images">
            <a href="http://twitter.com/share?url=http://martin-thoma.com/strassen-algorithm-in-python-java-cpp&amp;hashtags=python,c,java,strassen-algorithm,matrix-multiplication,&amp;via=themoosemind" target="_blank"><img src="http://martin-thoma.com/css/images/socialicons/twitter.png" width="32" height="32" alt="Twitter" /></a>
            <a href="http://del.icio.us/post?url=http://martin-thoma.com/strassen-algorithm-in-python-java-cpp&amp;title=Part%20II:%20The%20Strassen%20algorithm%20in%20Python,%20Java%20and%20C++" target="_blank"><img src="http://martin-thoma.com/css/images/socialicons/delicious.png" width="32" height="32" alt="Delicious" /></a>
            <a href="http://www.facebook.com/sharer.php?u=http://martin-thoma.com/strassen-algorithm-in-python-java-cpp" target="_blank"><img src="http://martin-thoma.com/css/images/socialicons/facebook.png" width="32" height="32" alt="Facebook" /></a>
            <a href="http://digg.com/submit?phase=2&amp;url=http://martin-thoma.com/strassen-algorithm-in-python-java-cpp&amp;title=Part%20II:%20The%20Strassen%20algorithm%20in%20Python,%20Java%20and%20C++" target="_blank"><img src="http://martin-thoma.com/css/images/socialicons/digg.png" width="32" height="32" alt="Digg" /></a>
            <a href="http://www.stumbleupon.com/submit?url=http://martin-thoma.com/strassen-algorithm-in-python-java-cpp&amp;title=Part%20II:%20The%20Strassen%20algorithm%20in%20Python,%20Java%20and%20C++" target="_blank"><img src="http://martin-thoma.com/css/images/socialicons/stumbleupon.png" width="32" height="32" alt="Stumbleupon" /></a>
            <a href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url=http://martin-thoma.com/strassen-algorithm-in-python-java-cpp" target="_blank"><img src="http://martin-thoma.com/css/images/socialicons/gplus.png" width="32" height="32" alt="Google Plus" /></a>
            <a href="http://reddit.com/submit?url=http://martin-thoma.com/strassen-algorithm-in-python-java-cpp&amp;title=Part%20II:%20The%20Strassen%20algorithm%20in%20Python,%20Java%20and%20C++" target="_blank"><img src="http://martin-thoma.com/css/images/socialicons/reddit.png" width="32" height="32" alt="Reddit" /></a>
    </div>
</div>
			        
		        <ul>
                    <li id="categories-3" class="widget widget_categories">
                        <!-- type: categories -->
<h2 class="widgettitle">Categories</h2>
    <ul>
        <li class="cat-item cat-item-11"><a href="http://martin-thoma.com/category/code/" title="Tipps for coding in different languages like Python oder C++.">Code</a></li>
        <li class="cat-item cat-item-21"><a href="http://martin-thoma.com/category/web/" title="New emerging websites and technologies.">The Web</a></li>
        <li class="cat-item cat-item-31"><a href="http://martin-thoma.com/category/cyberculture/" title="Lolcats, planking, Trollfaces, ...">Cyberculture</a></li>
        <li class="cat-item cat-item-3404"><a href="http://martin-thoma.com/category/maths/" title="View all posts filed under Mathematics">Mathematics</a></li>
        <li class="cat-item cat-item-881"><a href="http://martin-thoma.com/category/bits-and-bytes/" title="Sometimes posts don&#039;t fit in any category.">My bits and bytes</a></li>
        <li class="cat-item cat-item-41"><a href="http://martin-thoma.com/category/deutschland/" title="[All Posts here are written in German about German topics] - Die Bahn, unsere Politik und Europa.">German posts</a></li>
	</ul>

                    </li>
                    <li id="tag_cloud-3" class="widget widget_tag_cloud">
                        <h2 class="widgettitle">Tags</h2>
                        <div class="tagcloud"><a style='font-size: 104.13%' href='http://martin-thoma.com/tag/algebra/' title='6 topics'>Algebra</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/assembly-language/' title='5 topics'>Assembly language</a>
<a style='font-size: 104.13%' href='http://martin-thoma.com/tag/bash/' title='6 topics'>Bash</a>
<a style='font-size: 204.83%' href='http://martin-thoma.com/tag/c/' title='22 topics'>C</a>
<a style='font-size: 143.72%' href='http://martin-thoma.com/tag/cpp/' title='10 topics'>CPP</a>
<a style='font-size: 116.08%' href='http://martin-thoma.com/tag/challenge/' title='7 topics'>Challenge</a>
<a style='font-size: 143.72%' href='http://martin-thoma.com/tag/clip/' title='10 topics'>Clip</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/command-line/' title='5 topics'>Command Line</a>
<a style='font-size: 104.13%' href='http://martin-thoma.com/tag/computer-science/' title='6 topics'>Computer science</a>
<a style='font-size: 126.43%' href='http://martin-thoma.com/tag/digitaltechnik/' title='8 topics'>Digitaltechnik</a>
<a style='font-size: 104.13%' href='http://martin-thoma.com/tag/flashgames/' title='6 topics'>Flashgames</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/geometry/' title='5 topics'>Geometry</a>
<a style='font-size: 135.56%' href='http://martin-thoma.com/tag/google/' title='9 topics'>Google</a>
<a style='font-size: 126.43%' href='http://martin-thoma.com/tag/google-code-jam/' title='8 topics'>Google Code Jam</a>
<a style='font-size: 126.43%' href='http://martin-thoma.com/tag/it-security/' title='8 topics'>IT-Security</a>
<a style='font-size: 238.57%' href='http://martin-thoma.com/tag/java/' title='34 topics'>Java</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/javascript/' title='5 topics'>JavaScript</a>
<a style='font-size: 175.15%' href='http://martin-thoma.com/tag/kit/' title='15 topics'>KIT</a>
<a style='font-size: 197.45%' href='http://martin-thoma.com/tag/klausur/' title='20 topics'>Klausur</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/kogsys/' title='5 topics'>KogSys</a>
<a style='font-size: 211.58%' href='http://martin-thoma.com/tag/latex/' title='24 topics'>LaTeX</a>
<a style='font-size: 189.28%' href='http://martin-thoma.com/tag/linear-algebra/' title='18 topics'>Linear algebra</a>
<a style='font-size: 175.15%' href='http://martin-thoma.com/tag/linux/' title='15 topics'>Linux</a>
<a style='font-size: 126.43%' href='http://martin-thoma.com/tag/matrix/' title='8 topics'>Matrix</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/os/' title='5 topics'>OS</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/operating-systems/' title='5 topics'>Operating Systems</a>
<a style='font-size: 116.08%' href='http://martin-thoma.com/tag/php/' title='7 topics'>PHP</a>
<a style='font-size: 254.95%' href='http://martin-thoma.com/tag/programming/' title='42 topics'>Programming</a>
<a style='font-size: 135.56%' href='http://martin-thoma.com/tag/project-euler/' title='9 topics'>Project Euler</a>
<a style='font-size: 254.95%' href='http://martin-thoma.com/tag/python/' title='42 topics'>Python</a>
<a style='font-size: 104.13%' href='http://martin-thoma.com/tag/review/' title='6 topics'>Review</a>
<a style='font-size: 126.43%' href='http://martin-thoma.com/tag/swt-i/' title='8 topics'>SWT I</a>
<a style='font-size: 135.56%' href='http://martin-thoma.com/tag/theoretical-computer-science/' title='9 topics'>Theoretical computer science</a>
<a style='font-size: 104.13%' href='http://martin-thoma.com/tag/tikz/' title='6 topics'>Tikz</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/ubuntu/' title='5 topics'>Ubuntu</a>
<a style='font-size: 157.85%' href='http://martin-thoma.com/tag/video/' title='12 topics'>Video</a>
<a style='font-size: 126.43%' href='http://martin-thoma.com/tag/vimeo/' title='8 topics'>Vimeo</a>
<a style='font-size: 135.56%' href='http://martin-thoma.com/tag/web-development/' title='9 topics'>Web Development</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/wikipedia/' title='5 topics'>Wikipedia</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/wolfram-alpha/' title='5 topics'>Wolfram|Alpha</a>
<a style='font-size: 151.11%' href='http://martin-thoma.com/tag/youtube/' title='11 topics'>YouTube</a>
<a style='font-size: 90.00%' href='http://martin-thoma.com/tag/advertising/' title='5 topics'>advertising</a>
<a style='font-size: 116.08%' href='http://martin-thoma.com/tag/algorithms/' title='7 topics'>algorithms</a>
<a style='font-size: 104.13%' href='http://martin-thoma.com/tag/analysis/' title='6 topics'>analysis</a>
<a style='font-size: 169.80%' href='http://martin-thoma.com/tag/funny/' title='14 topics'>funny</a>
<a style='font-size: 175.15%' href='http://martin-thoma.com/tag/learning/' title='15 topics'>learning</a>
<a style='font-size: 143.72%' href='http://martin-thoma.com/tag/lecture-notes/' title='10 topics'>lecture-notes</a>
<a style='font-size: 270.00%' href='http://martin-thoma.com/tag/mathematics/' title='51 topics'>mathematics</a>
<a style='font-size: 201.23%' href='http://martin-thoma.com/tag/puzzle/' title='21 topics'>puzzle</a>
</div>
                    </li>
                </ul>
	            </div>
            </div>
		</div><!--/container-->
			<footer id="footer">
				<a href="http://martin-thoma.com"><strong>Martin Thoma</strong></a> -  A blog about Code, the Web and Cyberculture. <br />
                <div class="footer-credits">
                    <a href="http://flexithemes.com/themes/modern-style/">Modern Style</a> theme by <a href="http://flexithemes.com/">FlexiThemes</a>
                </div>
			</footer><!--/footer-->
            
	</div><!--/wrapper-->
<!-- type: footer -->
<!-- MathJax -->
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript">
<!--
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [ ['$$', '$$']],
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    processEscapes: true
  }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
// -->
</script>
<!-- TOC Plus -->
<script type='text/javascript'>
/* <![CDATA[ */
var tocplus = {"visibility_show":"show","visibility_hide":"hide","width":"275px"};
/* ]]> */
</script>
<script type='text/javascript' src="http://martin-thoma.com/js/tocplus-front.js"></script>

</body>
</html>

