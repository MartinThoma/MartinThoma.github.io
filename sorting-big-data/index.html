<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Martin Thoma" />
        <meta name="copyright" content="Martin Thoma" />
        <link title = "Martin Thoma"
              type  = "application/opensearchdescription+xml"
              rel   = "search"
              href  = "../opensearch.xml">

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Big Data, Python, Bash, sorting, Code, " />

<meta property="og:title" content="Sorting Big Data "/>
<meta property="og:url" content="sorting-big-data/" />
<meta property="og:description" content="Big Data was a common buzzword in industry in 2012 until 2017. It is still common, but hopefully less of a buzzword. Now other buzzwords are more common: trends.embed.renderExploreWidget(&#34;TIMESERIES&#34;, {&#34;comparisonItem&#34;:[{&#34;keyword&#34;:&#34;/m/0bs2j8q&#34;,&#34;geo&#34;:&#34;&#34;,&#34;time&#34;:&#34;2008-01-01 2020-03-24&#34;},{&#34;keyword&#34;:&#34;/m/01hyh_&#34;,&#34;geo&#34;:&#34;&#34;,&#34;time&#34;:&#34;2008-01-01 2020-03-24&#34;},{&#34;keyword&#34;:&#34;/m/0138n0j1 â€¦" />
<meta property="og:site_name" content="Martin Thoma" />
<meta property="og:article:author" content="Martin Thoma" />
<meta property="og:article:published_time" content="2020-05-29T20:00:00+02:00" />
<meta name="twitter:title" content="Sorting Big Data ">
<meta name="twitter:description" content="Big Data was a common buzzword in industry in 2012 until 2017. It is still common, but hopefully less of a buzzword. Now other buzzwords are more common: trends.embed.renderExploreWidget(&#34;TIMESERIES&#34;, {&#34;comparisonItem&#34;:[{&#34;keyword&#34;:&#34;/m/0bs2j8q&#34;,&#34;geo&#34;:&#34;&#34;,&#34;time&#34;:&#34;2008-01-01 2020-03-24&#34;},{&#34;keyword&#34;:&#34;/m/01hyh_&#34;,&#34;geo&#34;:&#34;&#34;,&#34;time&#34;:&#34;2008-01-01 2020-03-24&#34;},{&#34;keyword&#34;:&#34;/m/0138n0j1 â€¦">
<meta property="og:image" content="logos/python.png" />
<meta name="twitter:image" content="logos/python.png" >

        <title>Sorting Big Data  Â· Martin Thoma
</title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../static/print.css" media="print">
        <link rel="stylesheet" type="text/css" href="../static/custom.css" media="screen">

        <!-- MathJax -->
<script type="text/x-mathjax-config">
<!--
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [ ['$$', '$$'], ['\\[','\\]']],
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    processEscapes: true
  }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
// -->
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

        <link href="https://martin-thoma.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Martin Thoma - Full Atom Feed" />
        <link href="https://martin-thoma.com/feeds/index.xml" type="application/rss+xml" rel="alternate" title="Martin Thoma - Full RSS Feed" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top navbar-default">
            <div class="container">
                <div class="container-fluid">
                    <div class="collapse navbar-collapse">
                        <ul class="nav pull-left top-menu navbar-nav">
                            <li><a href=".." style="font-family: 'Monaco', 'Inconsolata', 'Andale Mono', 'Lucida Console', 'Bitstream Vera Sans Mono', 'Courier New', Courier, Monospace;
                        font-size: 20px;" class="navbar-brand" tabindex="-1">Martin Thoma</a>
                            </li>
                        </ul>
                        <ul class="nav pull-right top-menu navbar-nav">
                            <li ><a href="..">Home</a></li>
                            <li ><a href="../categories.html">Categories</a></li>
                            <li ><a href="../tags.html">Tags</a></li>
                            <li ><a href="../archives.html">Archives</a></li>
                            <li><a href="../support-me/">Support me</a></li>
                            <li><form class="navbar-form" action="../search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="search" class="search-query form-control" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-1 col-md-1"></div>
                <div class="col-sm-10 col-md-10">
<article>
<div class="row">
    <header class="page-header col-sm-10 col-md-10 col-md-offset-2">
    <h1><a href="sorting-big-data/"> Sorting Big Data  </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-sm-2 col-md-2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div id="toc"><ul><li><a class="toc-href" href="#data-generation" title="Data Generation">Data Generation</a><ul><li><a class="toc-href" href="#disk-space" title="Disk Space">Disk Space</a></li><li><a class="toc-href" href="#generate-it" title="Generate it!">Generate it!</a></li></ul></li><li><a class="toc-href" href="#bash-sorting_1" title="Bash Sorting">Bash Sorting</a></li><li><a class="toc-href" href="#python" title="Python">Python</a><ul><li><a class="toc-href" href="#merge-sort" title="Merge Sort">Merge Sort</a></li><li><a class="toc-href" href="#heap-sort" title="Heap Sort">Heap Sort</a></li><li><a class="toc-href" href="#trivial-radix-sort" title="Trivial Radix Sort">Trivial Radix Sort</a></li><li><a class="toc-href" href="#multi-process-radix-sort" title="Multi-process Radix Sort">Multi-process Radix Sort</a></li><li><a class="toc-href" href="#dask" title="Dask">Dask</a></li><li><a class="toc-href" href="#sqlite" title="SQLite">SQLite</a></li></ul></li><li><a class="toc-href" href="#c_1" title="C++">C++</a><ul><li><a class="toc-href" href="#single-core-radix-sort" title="Single-Core Radix-Sort">Single-Core Radix-Sort</a></li><li><a class="toc-href" href="#multi-core-radix-sort" title="Multi-Core Radix-Sort">Multi-Core Radix-Sort</a></li></ul></li><li><a class="toc-href" href="#see-also_1" title="See also">See also</a></li></ul></div>
        </nav>
    </div>
    <div class="col-sm-8 col-md-8 article-content" id="contentAfterTitle">

            
            <p><a href="https://en.wikipedia.org/wiki/Big_data">Big Data</a> was a common buzzword in
industry in 2012 until 2017. It is still common, but hopefully less of a
buzzword. Now other buzzwords are more common:</p>
<script src="https://ssl.gstatic.com/trends_nrtr/2152_RC03/embed_loader.js" type="text/javascript"></script>
<p><script type="text/javascript"> trends.embed.renderExploreWidget("TIMESERIES", {"comparisonItem":[{"keyword":"/m/0bs2j8q","geo":"","time":"2008-01-01 2020-03-24"},{"keyword":"/m/01hyh_","geo":"","time":"2008-01-01 2020-03-24"},{"keyword":"/m/0138n0j1","geo":"","time":"2008-01-01 2020-03-24"},{"keyword":"/m/0wkcjgj","geo":"","time":"2008-01-01 2020-03-24"},{"keyword":"/m/02_7vm","geo":"","time":"2008-01-01 2020-03-24"}],"category":0,"property":""}, {"exploreQuery":"date=2008-01-01%202020-03-24&amp;q=%2Fm%2F0bs2j8q,%2Fm%2F01hyh_,%2Fm%2F0138n0j1,%2Fm%2F0wkcjgj,%2Fm%2F02_7vm","guestPath":"https://trends.google.de:443/trends/embed/"}); </script></p>
<p>By the way, I didn't include "artificial intelligence" because it dominates all
of the others.</p>
<p>For me, a big-data solution means that I can't fit the critical part into
memory. This means that it is a question of time and money what problems
actually require a big data solution. Amazons <code>u-24tb1.metal</code> instance has 24
TB of memory. Yes, that is not a typo on my side. TB, not GB.
(<a href="https://aws.amazon.com/de/ec2/instance-types/high-memory/">source</a>). They
don't even publicly say how expensive those beasts are.</p>
<p>When it comes to big data, people think of
<a href="https://en.wikipedia.org/wiki/Apache_Hadoop">Hadoop</a> and
<a href="https://en.wikipedia.org/wiki/Apache_Spark">Spark</a>. I'm not sure if I want to
go into that rabbit hole for this article. I want to show how to sort huge
amounts of data on a single machine: My Thinkpad T460p with 8GB of memory.</p>
<p>Please note that an <code>x1e.32xlarge</code> EC2 instance with about 4 TB of RAM costs
about 27 USD per hour
(<a href="https://aws.amazon.com/de/ec2/pricing/on-demand/">source</a>). This means you
might not need such a solution for quite a while.</p>
<h2 id="data-generation">Data Generation</h2>
<p>I want to generate a bit of data and make it at least a tiny bit realistic. So
lets generate about 20GB of data in a CSV file.</p>
<h3 id="disk-space">Disk Space</h3>
<p>With <code>df -h</code> I realized that I only have 5 GB left of my 500GB HDD ðŸ˜¢</p>
<p>The <a href="http://www.marzocca.net/linux/baobab/">Disk Usage Analyzer</a> showed the
following disk space hogs:</p>
<ul>
<li>404 GB: My Home Directory:<ul>
<li>152 GB: Various git repsitories<ul>
<li>103 GB: My "algorithms" repository<ul>
<li>99 GB for PyPI (see <a href="https://martin-thoma.com/pypi-2020/">PyPI Analysis 2020</a>)</li>
<li>4 GB for a <a href="https://github.com/MartinThoma/algorithms/tree/master/Python/databases/benchmark">database benchmark</a>. I never really finished this; I moved on to other topics</li>
</ul>
</li>
<li>28 GB for <a href="https://github.com/A3M4/YouTube-Report">YouTube-Report</a>. Or rather the Takeout</li>
</ul>
</li>
<li>97 GB: Downloads<ul>
<li>1.5 GB: Photos of a hiking trip</li>
<li>800 MB: <a href="https://arxiv.org/pdf/1701.08380.pdf">HASYv2</a></li>
<li>many smaller things ... that would take a while. Maybe I should just delete everything</li>
</ul>
</li>
<li>44 GB: Pictures</li>
<li>22 GB: Dropbox</li>
<li>20 GB: .local</li>
<li>10 GB: .cache (mostly pip and pipenv)</li>
<li>9 GB: Anaconda</li>
<li>many smaller things</li>
</ul>
</li>
<li>26 GB <code>/usr</code><ul>
<li>7 GB TexLive</li>
<li>6 GB CUDA in different versions</li>
</ul>
</li>
<li>7 GB <code>/var</code><ul>
<li>5 GB journal logs</li>
</ul>
</li>
<li>some smaller things</li>
</ul>
<p>I'm astonished not to see Docker here ðŸ¤”</p>
<p>After this short cleanup, I have <code>128G</code> available ðŸŽ‰</p>
<h3 id="generate-it">Generate it!</h3>
<p>I don't want to spend too much time dealing with the actual element-by-element
comparison, so I want to use integers or strings to compare. I also don't want
to fiddle around with data organization, so I don't add a payload. We only
generate data which is sorted.</p>
<p>I can imagine two ways to generate data to sort: Random numbers and UUIDs.
Let's see which is faster (<a href="https://github.com/MartinThoma/algorithms/blob/master/sorting/timing.py">code on GitHub</a>):</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2020/03/number-generation-speed.png"><img alt="Time for generating 10k random elements" src="../images/2020/03/number-generation-speed.png" style="width: 512px;"/></a>
<figcaption class="text-center">Time for generating 10k random elements</figcaption>
</figure>
<p>As you can see, numpy is the fastest and UUIDv4 generation is by far the
slowest. But numpy cannot generate random integers which are that big and the
time difference is not that huge. Everything as expected.</p>
<p>So, let's say we generate those 36-character random numbers. Each of them needs
37 Byte - don't forget the newline. We want 20&thinsp;GB, we need 540&thinsp;540&thinsp;541 elements.
Lets say 550 million numbers. My machine needed about 0.05s to generate 10k, so
I expect it to take <code>540540541 / 10_000  * 0.05 / 60 = 45 min</code>. A good time to
get some food ðŸ™‚</p>
<p>Done after 32&nbsp;minutes. The file size is 20.4&thinsp;GB.</p>
<h2 id="bash-sorting_1">Bash Sorting</h2>
<p>Sorting with standard unix tools - namely <code>split</code> and <code>sort</code> - is the simplest
solution that popped to my mind which should also be pretty fast. I will
wrap all commands in <code>time (the actual command)</code> so that you can see how
fast they are.</p>
<p>Chunk the data:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">time</span> <span class="o">(</span>split -l <span class="m">10000000</span> numbers-large.txt chunk-<span class="o">)</span>

real    <span class="m">89</span>,00s
user    <span class="m">5</span>,16s
sys    <span class="m">25</span>,29s
</code></pre></div>
<p>Sort the chunks:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">time</span> <span class="o">(</span><span class="k">for</span> X in chunk-*<span class="p">;</span> <span class="k">do</span> sort -n &lt; <span class="nv">$X</span> &gt; sorted-<span class="nv">$X</span><span class="p">;</span> <span class="k">done</span><span class="o">)</span>

real    <span class="m">625</span>,44s
user    <span class="m">2768</span>,27s
sys    <span class="m">85</span>,40s
</code></pre></div>
<p>Merge:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">time</span> <span class="o">(</span>sort -n -m sorted-chunk* &gt; sorted.txt<span class="o">)</span>

real    <span class="m">531</span>,50s
user    <span class="m">470</span>,09s
sys    <span class="m">52</span>,20s
</code></pre></div>
<p>In total, this approach needed <strong>20 min and 46 seconds</strong>.</p>
<p>I will check other solutions for correctnes by the following command. It takes
91s just to check if the two files are identical!</p>
<div class="highlight"><pre><span></span><code>$ cmp -l shell-sort/sorted.txt other-solution.txt
</code></pre></div>
<h2 id="python">Python</h2>
<p>Let's see how quick I can do it with Python!</p>
<h3 id="merge-sort">Merge Sort</h3>
<p>You can see the code <a href="https://github.com/MartinThoma/algorithms/blob/master/sorting/mergesort.py">on GitHub</a>.
The idea is to (1) split the file into chunks that fit into memory (2) sort the
chunks (3) merge the chunks pair-wise. With this approach, you only have to
keep two chunks at a time in memory.</p>
<p>This takes many hours to execute.</p>
<p>There are a couple of things that come in handy when you have long-running
processes:</p>
<ul>
<li>Progressbars: You want to have an indicator how much time is remaining. Or if
  something crashed.</li>
<li>Resumability: You want to be able to interrupt and resume later. An
  additional benefit is that the program becomes more robust against crashes.
  You achieve this by storing intermediate results.</li>
</ul>
<h3 id="heap-sort">Heap Sort</h3>
<p>Basically the same idea as with merge sort, but using heapq:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">heapq</span>


<span class="k">def</span> <span class="nf">merge_files</span><span class="p">(</span><span class="n">filepath1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filepath2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">outpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Using heapq to merge two files.</span>

<span class="sd">    See https://docs.python.org/2/library/heapq.html#heapq.merge</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath1</span><span class="p">)</span> <span class="k">as</span> <span class="n">f1</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath2</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">heapq</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">):</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>
<p>This takes 10420s (2h 53min 40s) to execute.</p>
<h3 id="trivial-radix-sort">Trivial Radix Sort</h3>
<p>Again, same idea as with the mergesort and the heapsort approach:</p>
<ol>
<li><strong>Chunking</strong>: Generate 90 chunks for all of the 2-letter prefixes (10, 11,
   12, ... 97, 98, 99). Each chunk is now small enough to fit into memory.</li>
<li><strong>Chunk sorting</strong>: Sort each chunk individually.</li>
<li><strong>Combining</strong>: Combine all of the chunks. As they were created by prefixes,
   this is just simply pasting the files together in the order of the prefixes.</li>
</ol>
<p>The difference in this case is the chunking. That part already does a great
deal of the sorting which makes the combining step trivial.</p>
<p>Timing:</p>
<ol>
<li>Chunking: 290.4s</li>
<li>Chunk Sorting: 779.5s</li>
<li>Combining: 208.4s</li>
</ol>
<p>In total, the Python Radix-Sort is at <strong>21 min and 30 seconds</strong>.</p>
<h3 id="multi-process-radix-sort">Multi-process Radix Sort</h3>
<p>Most of the time is spent on sorting. However, I only used one core. So we can
improve the wall-clock execution time by running on multiple cores!</p>
<p>To do so, we make a minor adjustment:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">sort_chunks</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sort_chunk</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s2">"chunks_to_sort"</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div>
<p>Timing:</p>
<table class="table">
<thead>
<tr>
<th>Task</th>
<th>2.7.18</th>
<th>3.6.10</th>
<th>3.7.7</th>
<th>3.8.3</th>
<th>3.9.0a</th>
</tr>
</thead>
<tr>
<td>Chunking</td>
<td>192.2s</td>
<td>302.5s</td>
<td>308.5s</td>
<td>279.8s</td>
<td>292.6s</td>
</tr>
<tr>
<td>Chunk Sorting</td>
<td>262.4s</td>
<td>301.0s</td>
<td>253.3s</td>
<td>248.6s</td>
<td>252.0s</td>
</tr>
<tr>
<td>Combining Chunks</td>
<td>137.3s</td>
<td>212.1s</td>
<td>221.5s</td>
<td>187.2s</td>
<td>195.5s</td>
</tr>
<tfoot>
<tr>
<th>Total</th>
<th>592.1s</th>
<th>815.8s</th>
<th>783.6s</th>
<th>715.7s</th>
<th>740.2s</th>
</tr>
</tfoot>
</table>
<p>In total, the Python parallel Radix-Sort is at <strong>12 min and 45 seconds</strong>.</p>
<p>The speed-up is 3.1x.</p>
<p>It's quite weird that Python 2.7 is way faster than Python 3.6+. I've asked
on StackOverflow <a href="https://stackoverflow.com/q/62079732/562769">Did I/O or dictionaries become slower since Python 2.7?</a>,
but didn't receive an answer so far.</p>
<h3 id="dask">Dask</h3>
<p>I wanted to give <a href="https://dask.org/">Dask</a> a try and got some help from. However, I interrupted the
execution of the following solution after 5 hours:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">"numbers-large.txt"</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">"numbers-large-sorted-dask.txt"</span>
<span class="n">blocksize</span> <span class="o">=</span> <span class="mi">1_000_000</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Create ddf"</span><span class="p">)</span>
<span class="n">ddf</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blocksize</span><span class="o">=</span><span class="n">blocksize</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Sort"</span><span class="p">)</span>
<span class="n">ddf_sorted</span> <span class="o">=</span> <span class="n">ddf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Write"</span><span class="p">)</span>
<span class="n">fut</span> <span class="o">=</span> <span class="n">ddf_sorted</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">single_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">fut</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Stop"</span><span class="p">)</span>
</code></pre></div>
<h3 id="sqlite">SQLite</h3>
<p>Databases should be able to deal with large amounts of data, right? So let's
create a database with a single table and a single column, insert the data
and use SQL to sort:</p>
<div class="highlight"><pre><span></span><code><span class="sd">"""Sort a huge amount of data by inserting it into SQLite."""</span>

<span class="c1"># Core Library modules</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">"</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">"</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
    <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">big_filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">db_filepath</span> <span class="o">=</span> <span class="s2">"numbers-large.sqlite"</span>
    <span class="n">output_filepath</span> <span class="o">=</span> <span class="s2">"sqlite-sorted-numbers.txt"</span>

    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">create_db</span><span class="p">(</span><span class="n">big_filepath</span><span class="p">,</span> <span class="n">db_filepath</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"create_db finished in </span><span class="si">{</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">read_sort_write</span><span class="p">(</span><span class="n">db_filepath</span><span class="p">,</span> <span class="n">output_filepath</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"sorting and writing with sqlite finished in </span><span class="si">{</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">create_db</span><span class="p">(</span><span class="n">big_filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db_filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span><span class="p">):</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filepath</span><span class="p">)</span>

    <span class="c1"># Create the table</span>
    <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"CREATE TABLE numbers(i)"</span><span class="p">)</span>

    <span class="n">batch_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">big_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="p">,))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">batch_size</span><span class="p">:</span>
                <span class="n">con</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">"INSERT INTO numbers(i) VALUES (?)"</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
                <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">batch_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Finished batch </span><span class="si">{</span><span class="n">batch_count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">"insert into numbers(i) values (?)"</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Make index"</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"CREATE INDEX fooindex ON numbers(i)"</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Finished making index."</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Finished creation of SQLiteDB"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">read_sort_write</span><span class="p">(</span><span class="n">db_filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filepath</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT i FROM numbers ORDER BY i ASC"</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_filepath</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="s2">"numbers-large.txt"</span><span class="p">)</span>
</code></pre></div>
<p>Timing it:</p>
<ul>
<li>create_db: 850s</li>
<li>sorting and writing with sqlite: 1184s</li>
</ul>
<p>In total, it needed 2033s (33min 53s).</p>
<p>If you make that single column an index after inserting:</p>
<ul>
<li>create_db: 1980s (index-making added 1130s)</li>
<li>sorting and writing with sqlite: 432s (index made it faster by 752s)</li>
</ul>
<h2 id="c_1">C++</h2>
<h3 id="single-core-radix-sort">Single-Core Radix-Sort</h3>
<p>For implementing it, the following was important:</p>
<ul>
<li>File Flushing: If you use <code>endl</code> for the newline, then the chunking step alone
  takes 1814s. That one takes 290s with Python.</li>
<li><code>-O3</code>: Just compile it with <code>g++ -O3 radixsort.cpp</code>.</li>
</ul>
<p>Here is the code:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">chunk_data</span><span class="p">(</span><span class="n">string</span> <span class="n">big_filepath</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">chunks_to_sort</span><span class="p">;</span>
    <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">ofstream</span><span class="o">*</span> <span class="o">&gt;</span> <span class="n">prefix2file</span><span class="p">;</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"mkdir cpp-radix"</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">prefix2file</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ofstream</span><span class="p">(</span><span class="s">"cpp-radix/"</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">".txt"</span><span class="p">);</span>
        <span class="n">chunks_to_sort</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"cpp-radix/"</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">".txt"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Read and split the file</span>
    <span class="n">ifstream</span> <span class="n">infile</span><span class="p">(</span><span class="n">big_filepath</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">line</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"start chunking"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">infile</span> <span class="o">&gt;&gt;</span> <span class="n">line</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">prefix2file</span><span class="p">[</span><span class="n">line</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span> <span class="o">&lt;&lt;</span> <span class="n">line</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"chunking done"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Close files</span>
    <span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="n">ofstream</span><span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">it</span><span class="o">=</span><span class="n">prefix2file</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
        <span class="n">it</span><span class="o">!=</span><span class="n">prefix2file</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">chunks_to_sort</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">sort_chunk</span><span class="p">(</span><span class="n">string</span> <span class="n">filepath</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Read</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">lines</span><span class="p">;</span>
    <span class="n">ifstream</span> <span class="nf">infile</span><span class="p">(</span><span class="n">filepath</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">line</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">infile</span> <span class="o">&gt;&gt;</span> <span class="n">line</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Sort</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">lines</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

    <span class="c1">// write</span>
    <span class="n">ofstream</span> <span class="nf">output_file</span><span class="p">(</span><span class="s">"filepath"</span><span class="p">);</span>
    <span class="n">ostream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">output_iterator</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">copy</span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">lines</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">output_iterator</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">merge</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">chunks</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ofstream</span> <span class="n">output_file</span><span class="p">(</span><span class="s">"cpp-sorted.txt"</span><span class="p">);</span>
    <span class="n">ostream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">output_iterator</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="c1">// iterate over the vector</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it_chunk</span><span class="p">;</span>
    <span class="cp">#pragma omp parallel for</span>
    <span class="k">for</span><span class="p">(</span><span class="n">it_chunk</span><span class="o">=</span><span class="n">chunks</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it_chunk</span> <span class="o">!=</span> <span class="n">chunks</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">it_chunk</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Sort "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it_chunk</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="c1">// Read file</span>
        <span class="n">ifstream</span> <span class="nf">infile</span><span class="p">(</span><span class="o">*</span><span class="n">it_chunk</span><span class="p">);</span>
        <span class="n">string</span> <span class="n">line</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">infile</span> <span class="o">&gt;&gt;</span> <span class="n">line</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">output_file</span> <span class="o">&lt;&lt;</span> <span class="n">line</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">infile</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">chunks_to_sort</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="p">(</span><span class="s">"numbers-large.txt"</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it_chunk</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">it_chunk</span><span class="o">=</span><span class="n">chunks_to_sort</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it_chunk</span> <span class="o">!=</span> <span class="n">chunks_to_sort</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">it_chunk</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Sort "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it_chunk</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">sort_chunk</span><span class="p">(</span><span class="o">*</span><span class="n">it_chunk</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Merge"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">merge</span><span class="p">(</span><span class="n">chunks_to_sort</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"done"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>In total, it took 18min 50s.</p>
<h3 id="multi-core-radix-sort">Multi-Core Radix-Sort</h3>
<p>Add <code>#pragma omp parallel for</code>, compile with the following flags and off it goes!</p>
<div class="highlight"><pre><span></span><code>g++ radixsort.cpp -O3 -std<span class="o">=</span>c++11 -Wall -pedantic -fopenmp
</code></pre></div>
<p>In total, 715s (11min 55s)</p>
<h2 id="see-also_1">See also</h2>
<p>StackExchange</p>
<ul>
<li><a href="https://stackoverflow.com/q/34090744/562769">How can I sort a 10GB file?</a>, 2015.</li>
<li><a href="https://martin-thoma.com/ubersicht-uber-sortieralgorithmen/">&Uuml;bersicht &uuml;ber Sortieralgorithmen</a> (German)</li>
</ul>
            
            <div id="disqus_thread" class="no-print"></div>
<script>
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');

        s.src = '//martinthoma.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

            <hr/>
        </div>
        <section>
        <div class="col-sm-2 col-md-2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2020-05-29T20:00:00+02:00">Mai 29, 2020</time>
            <br/>
            by <a rel="author" class="vcard author post-author" itemprop="author" href="../author/martin-thoma/"><span class="fn" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name">Martin Thoma</span></span></a>
            <h4>Category</h4>
            <a class="category-link" href="../categories.html#code-ref">Code</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="../tags.html#bash-ref">Bash
                    <span>7</span>
</a></li>
                <li><a href="../tags.html#big-data-ref">Big Data
                    <span>1</span>
</a></li>
                <li><a href="../tags.html#python-ref">Python
                    <span>125</span>
</a></li>
                <li><a href="../tags.html#sorting-ref">sorting
                    <span>3</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="https://twitter.com/themoosemind" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="mailto:info@martin-thoma.de" title="My Email Address" class="sidebar-social-links" target="_blank">
    <i class="fa fa-envelope sidebar-social-links"></i></a>
    <a href="https://github.com/MartinThoma" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="http://stackoverflow.com/users/562769/martin-thoma" title="My Stackoverflow Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-stackoverflow sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="col-sm-1 col-md-1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer class="no-print">
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-subtitle"><span class="site-name">Martin Thoma</span> - A blog about Code, the Web and Cyberculture</li>
        <li><a href="https://martin-thoma.com/feeds/index.xml">RSS-Feed</a></li>
        <li><a href="http://www.martin-thoma.de/privacy.htm">Datenschutzerkl&auml;rung</a></li>
        <li><a href="http://www.martin-thoma.de/impressum.htm">Impressum</a></li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page" tabindex="-1">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page" tabindex="-1">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page" tabindex="-1">Talha Mansoor</a></li>
    </ul>
</div>
</footer>        <script src="//code.jquery.com/jquery.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script>
(function(){
    'use strict';

    /*
    Create intra-page links
    Requires that your headings already have an `id` attribute set
    For every heading in your page, this adds a little anchor link `#` that you can click to get a permalink to the heading.
    Ignores `h1`, because you should only have one per page.
    The text content of the tag is used to generate the link, so it will fail "gracefully-ish" if you have duplicate heading text.

    Credit: https://gist.github.com/SimplGy/a229d25cdb19d7f21231
     */

    var headingNodes = [], results, link,
        tags = ['h2', 'h3', 'h4', 'h5', 'h6'];

    tags.forEach(function(tag){
        var contentTag = document.getElementById('contentAfterTitle');
      results = contentTag.getElementsByTagName(tag);
      Array.prototype.push.apply(headingNodes, results);
    });

    headingNodes.forEach(function(node){
      link = document.createElement('a');
      link.className = 'deepLink';
      link.textContent = ' Â¶';
      link.href = '#' + node.getAttribute('id');
      node.appendChild(link);
    });

  })();
</script>
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>