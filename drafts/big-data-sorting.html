<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Martin Thoma" />
        <meta name="copyright" content="Martin Thoma" />
        <link title = "Martin Thoma"
              type  = "application/opensearchdescription+xml"
              rel   = "search"
              href  = "../opensearch.xml">

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Big Data, Python, Code, " />

<meta property="og:title" content="Big Data: Sorting"/>
<meta property="og:url" content="../drafts/big-data-sorting.html" />
<meta property="og:description" content="Big Data was a common buzzword in industry in 2012 until 2017. It is still common, but hopefully less of a buzzword. Now other other buzzwords are more common: trends.embed.renderExploreWidget(&#34;TIMESERIES&#34;, {&#34;comparisonItem&#34;:[{&#34;keyword&#34;:&#34;/m/0bs2j8q&#34;,&#34;geo&#34;:&#34;&#34;,&#34;time&#34;:&#34;2008-01-01 2020-03-24&#34;},{&#34;keyword&#34;:&#34;/m/01hyh_&#34;,&#34;geo&#34;:&#34;&#34;,&#34;time&#34;:&#34;2008-01-01 2020-03-24&#34;},{&#34;keyword&#34;:&#34;/m â€¦" />
<meta property="og:site_name" content="Martin Thoma" />
<meta property="og:article:author" content="Martin Thoma" />
<meta property="og:article:published_time" content="2020-03-24T20:00:00+01:00" />
<meta name="twitter:title" content="Big Data: Sorting">
<meta name="twitter:description" content="Big Data was a common buzzword in industry in 2012 until 2017. It is still common, but hopefully less of a buzzword. Now other other buzzwords are more common: trends.embed.renderExploreWidget(&#34;TIMESERIES&#34;, {&#34;comparisonItem&#34;:[{&#34;keyword&#34;:&#34;/m/0bs2j8q&#34;,&#34;geo&#34;:&#34;&#34;,&#34;time&#34;:&#34;2008-01-01 2020-03-24&#34;},{&#34;keyword&#34;:&#34;/m/01hyh_&#34;,&#34;geo&#34;:&#34;&#34;,&#34;time&#34;:&#34;2008-01-01 2020-03-24&#34;},{&#34;keyword&#34;:&#34;/m â€¦">
<meta property="og:image" content="logos/python.png" />
<meta name="twitter:image" content="logos/python.png" >

        <title>Big Data: Sorting Â· Martin Thoma
</title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../static/print.css" media="print">
        <link rel="stylesheet" type="text/css" href="../static/custom.css" media="screen">

        <!-- MathJax -->
<script type="text/x-mathjax-config">
<!--
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [ ['$$', '$$'], ['\\[','\\]']],
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    processEscapes: true
  }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
// -->
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

        <link href="https://martin-thoma.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Martin Thoma - Full Atom Feed" />
        <link href="https://martin-thoma.com/feeds/index.xml" type="application/rss+xml" rel="alternate" title="Martin Thoma - Full RSS Feed" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top navbar-default">
            <div class="container">
                <div class="container-fluid">
                    <div class="collapse navbar-collapse">
                        <ul class="nav pull-left top-menu navbar-nav">
                            <li><a href=".." style="font-family: 'Monaco', 'Inconsolata', 'Andale Mono', 'Lucida Console', 'Bitstream Vera Sans Mono', 'Courier New', Courier, Monospace;
                        font-size: 20px;" class="navbar-brand">Martin Thoma</a>
                            </li>
                        </ul>
                        <ul class="nav pull-right top-menu navbar-nav">
                            <li ><a href="..">Home</a></li>
                            <li ><a href="../categories.html">Categories</a></li>
                            <li ><a href="../tags.html">Tags</a></li>
                            <li ><a href="../archives.html">Archives</a></li>
                            <li><a href="../support-me/">Support me</a></li>
                            <li><form class="navbar-form" action="../search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="search" class="search-query form-control" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-1 col-md-1"></div>
                <div class="col-sm-10 col-md-10">
<article>
<div class="row">
    <header class="page-header col-sm-10 col-md-10 col-md-offset-2">
    <h1><a href="../drafts/big-data-sorting.html"> Big Data: Sorting </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-sm-2 col-md-2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div id="toc"><ul><li><a class="toc-href" href="#data-generation" title="Data Generation">Data Generation</a><ul><li><a class="toc-href" href="#disk-space" title="Disk Space">Disk Space</a></li><li><a class="toc-href" href="#generate-it" title="Generate it!">Generate it!</a></li></ul></li></ul></div>
        </nav>
    </div>
    <div class="col-sm-8 col-md-8 article-content" id="contentAfterTitle">

            
            <p><a href="https://en.wikipedia.org/wiki/Big_data">Big Data</a> was a common buzzword in
industry in 2012 until 2017. It is still common, but hopefully less of a
buzzword. Now other other buzzwords are more common:</p>
<script src="https://ssl.gstatic.com/trends_nrtr/2152_RC03/embed_loader.js" type="text/javascript"></script>
<p><script type="text/javascript"> trends.embed.renderExploreWidget("TIMESERIES", {"comparisonItem":[{"keyword":"/m/0bs2j8q","geo":"","time":"2008-01-01 2020-03-24"},{"keyword":"/m/01hyh_","geo":"","time":"2008-01-01 2020-03-24"},{"keyword":"/m/0138n0j1","geo":"","time":"2008-01-01 2020-03-24"},{"keyword":"/m/0wkcjgj","geo":"","time":"2008-01-01 2020-03-24"},{"keyword":"/m/02_7vm","geo":"","time":"2008-01-01 2020-03-24"}],"category":0,"property":""}, {"exploreQuery":"date=2008-01-01%202020-03-24&amp;q=%2Fm%2F0bs2j8q,%2Fm%2F01hyh_,%2Fm%2F0138n0j1,%2Fm%2F0wkcjgj,%2Fm%2F02_7vm","guestPath":"https://trends.google.de:443/trends/embed/"}); </script></p>
<p>By the way, I didn't include "artificial intelligence" because it dominates all
of the others.</p>
<p>For me, a big-data solution means that I can't fit the critical part into
memory. This means that it is a question of time and money what problems
actually require a big data solution. Amazons <code>u-24tb1.metal</code> instance has 24
TB of memory. Yes, that is not a typo on my side. TB, not GB.
(<a href="https://aws.amazon.com/de/ec2/instance-types/high-memory/">source</a>). They
don't even publicly say how expensive those beasts are.</p>
<p>When it comes to big data, people think of
<a href="https://en.wikipedia.org/wiki/Apache_Hadoop">Hadoop</a> and
<a href="https://en.wikipedia.org/wiki/Apache_Spark">Spark</a>. However, for this article
I want to use pure Python. In this article I want to show how to sort huge
amounts of data on a single machine: My Thinkpad T460p with 8GB of memory.</p>
<p>Please note that an <code>x1e.32xlarge</code> EC2 instance with about 4 TB of RAM costs
about 27 USD per hour
(<a href="https://aws.amazon.com/de/ec2/pricing/on-demand/">source</a>). This means you
might not need such a solution for quite a while.</p>
<h2 id="data-generation">Data Generation</h2>
<p>I want to generate a bit of data and make it at least a tiny bit realistic. So
lets generate about 20GB of data in a CSV file.</p>
<h3 id="disk-space">Disk Space</h3>
<p>With <code>df -h</code> I realized that I only have 5 GB left of my 500GB HDD ðŸ˜¢</p>
<p>The <a href="http://www.marzocca.net/linux/baobab/">Disk Usage Analyzer</a> showed the
following disk space hogs:
* 404 GB: My Home Directory:
    * 152 GB: Various git repsitories
        * 103 GB: My "algorithms" repository
            * 99 GB for PyPI (see <a href="https://martin-thoma.com/pypi-2020/">PyPI Analysis 2020</a>)
            * 4 GB for a <a href="https://github.com/MartinThoma/algorithms/tree/master/Python/databases/benchmark">database benchmark</a>. I never really finished this; I moved on to other topics
        * 28 GB for <a href="https://github.com/A3M4/YouTube-Report">YouTube-Report</a>. Or rather the Takeout
    * 97 GB: Downloads
        * 1.5 GB: Photos of a hiking trip
        * 800 MB: <a href="https://arxiv.org/pdf/1701.08380.pdf">HASYv2</a>
        * many smaller things ... that would take a while. Maybe I should just delete everything
    * 44 GB: Pictures
    * 22 GB: Dropbox
    * 20 GB: .local
    * 10 GB: .cache (mostly pip and pipenv)
    * 9 GB: Anaconda
    * many smaller things
* 26 GB <code>/usr</code>
    * 7 GB TexLive
    * 6 GB CUDA in different versions
* 7 GB <code>/var</code>
    * 5 GB journal logs
* some smaller things</p>
<p>I'm astonished not to see Docker here ðŸ¤”</p>
<p>After this short cleanup, I have <code>128G</code> available ðŸŽ‰</p>
<h3 id="generate-it">Generate it!</h3>
<p>I don't want to spend too much time dealing with the actual element-by-element
comparison, so I want to use integers or strings to compare. I also don't want
to fiddle around with data organization, so I don't add a payload. We only
generate data which is sorted.</p>
<p>I can imagine two ways to generate data to sort: Random numbers and UUIDs.
Let's see which is faster (<a href="https://github.com/MartinThoma/algorithms/blob/master/sorting/timing.py">code on GitHub</a>):</p>
<figure class="wp-caption aligncenter img-thumbnail">
<a href="../images/2020/03/number-generation-speed.png"><img alt="Time for generating 10k random elements" src="../images/2020/03/number-generation-speed.png" style="width: 512px;"/></a>
<figcaption class="text-center">Time for generating 10k random elements</figcaption>
</figure>
<p>As you can see, numpy is the fastest and UUIDv4 generation is by far the
slowest. But numpy cannot generate random integers which are that big and the
time difference is not that huge. Everything as expected.</p>
<p>So, let's say we generate those 36-character random numbers. Each of them needs
37 Byte - don't forget the newline. We want 20GB, we need 540,540,541 elements.
Lets say 550 million numbers. My machine needed about 0.05s to generate 10k, so
I expect it to take <code>540540541 / 10_000  * 0.05 / 60 = 45 min</code>. A good time to
get some food ðŸ™‚</p>
<p>Done after 32 minutes. The file size is 20.4 GB.</p>
            
            <div id="disqus_thread" class="no-print"></div>
<script>
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');

        s.src = '//martinthoma.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

            <hr/>
        </div>
        <section>
        <div class="col-sm-2 col-md-2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2020-03-24T20:00:00+01:00">MÃ¤r 24, 2020</time>
            <br/>
            by <a rel="author" class="vcard author post-author" itemprop="author" href="../author/martin-thoma/"><span class="fn" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name">Martin Thoma</span></span></a>
            <h4>Category</h4>
            <a class="category-link" href="../categories.html#code-ref">Code</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="../tags.html#big-data-ref">Big Data
</a></li>
                <li><a href="../tags.html#python-ref">Python
                    <span>111</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="https://twitter.com/themoosemind" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="mailto:info@martin-thoma.de" title="My Email Address" class="sidebar-social-links" target="_blank">
    <i class="fa fa-envelope sidebar-social-links"></i></a>
    <a href="https://github.com/MartinThoma" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="http://stackoverflow.com/users/562769/martin-thoma" title="My Stackoverflow Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-stackoverflow sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="col-sm-1 col-md-1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer class="no-print">
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-subtitle"><span class="site-name">Martin Thoma</span> - A blog about Code, the Web and Cyberculture</li>
        <li><a href="http://www.martin-thoma.de/privacy.htm">Datenschutzerkl&auml;rung</a></li>
        <li><a href="http://www.martin-thoma.de/impressum.htm">Impressum</a></li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>        <script src="//code.jquery.com/jquery.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script>
(function(){
    'use strict';

    /*
    Create intra-page links
    Requires that your headings already have an `id` attribute set (because that's what jekyll does)
    For every heading in your page, this adds a little anchor link `#` that you can click to get a permalink to the heading.
    Ignores `h1`, because you should only have one per page.
    The text content of the tag is used to generate the link, so it will fail "gracefully-ish" if you have duplicate heading text.

    Credit: https://gist.github.com/SimplGy/a229d25cdb19d7f21231
     */

    var headingNodes = [], results, link,
        tags = ['h2', 'h3', 'h4', 'h5', 'h6'];

    tags.forEach(function(tag){
        var contentTag = document.getElementById('contentAfterTitle');
      results = contentTag.getElementsByTagName(tag);
      Array.prototype.push.apply(headingNodes, results);
    });

    headingNodes.forEach(function(node){
      link = document.createElement('a');
      link.className = 'deepLink';
      link.textContent = ' Â¶';
      link.href = '#' + node.getAttribute('id');
      node.appendChild(link);
    });

  })();
</script>
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>