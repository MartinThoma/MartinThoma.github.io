<!doctype html>
<html lang="en">
  <!-- type: head.html -->
  <head>
    <meta charset="utf-8">
    
    

    
        <meta name="thumbnail" content="//martin-thoma.com/images/logos/python.png" />
        <meta property="og:image" content="//martin-thoma.com/images/logos/python.png" />
    

    <meta property="og:type" content="blog"/>

    <title>Lasagne for Python Newbies</title>
    <meta property="og:title" content="Lasagne for Python Newbies" />
    <meta property="og:url" content="//martin-thoma.com/lasagne-for-python-newbies" />
    <link rel="stylesheet" href="//martin-thoma.com/css/screen.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="//martin-thoma.com/css/style.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="//martin-thoma.com/css/pygments.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="//martin-thoma.com/css/tocplus-screen.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="//martin-thoma.com/css/print.css" type="text/css" media="print" />
    <link rel="stylesheet" href="//martin-thoma.com/css/handheld.css" type="text/css" media="only screen and (max-device-width: 480px)" />

    <link rel="alternate" type="application/rss+xml" title="Martin Thoma RSS Feed" href="//martin-thoma.com/feed/" /><!--TODO-->
    <link rel="shortcut icon" href="//martin-thoma.com/favicon.ico" type="image/x-icon" />

    <link rel="canonical" href="//martin-thoma.com/lasagne-for-python-newbies" />
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:site" content="@themoosemind"/>
<meta name="twitter:creator" content="@themoosemind"/>
<meta name="twitter:title" content="Lasagne for Python Newbies"/>

    <meta name="twitter:description" content="A blog about Code, the Web and Cyberculture" />


    <meta name="twitter:image" content="//martin-thoma.com/images/logos/python.png"/>



<meta name="twitter:url" content="//martin-thoma.com/lasagne-for-python-newbies"/>
<meta name="twitter:domain" content="Martin Thoma.com"/>


    <script type='text/javascript' src="//martin-thoma.com/js/jquery.js"></script>
    <script type='text/javascript' src="//martin-thoma.com/js/jquery-migrate.min.js"></script>
    <style type="text/css">div#toc_container {width: 275px;}</style>
    <style type="text/css" id="syntaxhighlighteranchor"></style>

<!-- MathJax -->
<script type="text/x-mathjax-config">
<!--
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [ ['$$', '$$'], ['\\[','\\]']],
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    processEscapes: true
  }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
// -->
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<!-- Latest compiled and minified CSS bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
</head>

<!-- type: post.html -->
<body>
    <div id="wrapper">
        <div id="container" class="container">
            <div class="span-16">
                <!-- type: header.html -->
<div id="header" role="banner">
    <h1><a href="//martin-thoma.com">Martin Thoma</a></h1>
    <h2 style="margin-top: 0;">A blog about Code, the Web and Cyberculture.</h2>
</div>
<nav class="navcontainer" role="navigation">
    <ul id="nav">
        <li class=""><a href="//martin-thoma.com">Home</a></li>
        <li class="page_item page-item-41 "><a href="//martin-thoma.com/author/martin-thoma/">About Me</a></li>
        <li class="page_item page-item-91 "><a href="//martin-thoma.com/imprint/">Imprint</a></li>
    </ul>
</nav>

                <div id="content">
                    <article class="post type-post format-standard hentry clearfix" itemscope itemType="http://schema.org/BlogPosting">
                        <h2 class="title entry-title" itemprop="name headline">Lasagne for Python Newbies</h2>
                        
                            <meta name="image" itemprop="image" content="https://martin-thoma.com/images/logos/python.png" />
                        
                        <link itemprop="mainEntityOfPage" href="//martin-thoma.com/lasagne-for-python-newbies" />
                        <div class="postdate entry-date date-header">
                            <time datetime="2015-04-17T19:26:00+02:00" itemprop="datePublished">
                                April
                                17th,
                                  
                                2015
                            </time>
                        </div>

                        <div class="entry post-body" id="contentAfterTitle" itemprop="articleBody">
                            <p>Lasagne is a Python package for training neural networks. The nice thing about
Lasagne is that it is possible to write Python code and execute the training
on nVidea GPUs with automatically generated CUDA code.</p>

<p>However, installing Lasagne is not that easy. Especially if you are not
familiar with Python. This article aims to guide you through the installation
process.</p>

<div id="toc_container" class="toc_light_blue no_bullets">
   <p class="toc_title">Contents</p>
   <ul class="toc_list">
      <li class="toc_level-1 toc_section-1">
         <a href="#tocAnchor-1-1"><span class="tocnumber">1</span> <span class="toctext">Python</span></a>
      </li>
      <li class="toc_level-1 toc_section-2">
         <a href="#tocAnchor-1-2"><span class="tocnumber">2</span> <span class="toctext">sklearn</span></a>
      </li>
      <li class="toc_level-1 toc_section-3">
         <a href="#tocAnchor-1-3"><span class="tocnumber">3</span> <span class="toctext">Graphics drivers and CUDA</span></a>
      </li>
      <li class="toc_level-1 toc_section-4">
         <a href="#tocAnchor-1-4"><span class="tocnumber">4</span> <span class="toctext">Theano</span></a>
      </li>
      <li class="toc_level-1 toc_section-5">
         <a href="#tocAnchor-1-5"><span class="tocnumber">5</span> <span class="toctext">Lasagne</span></a>
      </li>
      <li class="toc_level-1 toc_section-6">
         <a href="#tocAnchor-1-6"><span class="tocnumber">6</span> <span class="toctext">nolearn</span></a>
      </li>
      <li class="toc_level-1 toc_section-7">
         <a href="#tocAnchor-1-7"><span class="tocnumber">7</span> <span class="toctext">See also</span></a>
      </li>
   </ul>
</div><h2 id="tocAnchor-1-1">Python</h2>

<p>Ubuntu-based systems will have Python installed, but I’m not too sure about
pip. You can get it with</p>

<pre><code>$ sudo apt-get install python-pip
</code></pre>

<p>Make sure you have Python and <code>pip</code>, the standard Python package installer.
Type the following commands to check if you have both:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>$ python --version
Python 2.7.8

$ pip --version
pip 6.1.1 from /usr/local/lib/python2.7/dist-packages (python 2.7)
</pre></div>
</div>
</div>

<h2 id="tocAnchor-1-2">sklearn</h2>

<p><a href="http://scikit-learn.org/stable/">sklearn</a> is a nice package for machine
learning. You can install it with</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>$ pip install scikit-learn
</pre></div>
</div>
</div>

<p>(When I write commands like this you either have to execute
<code>sudo pip install scikit-learn</code> or <code>pip install scikit-learn --user</code>).</p>

<p>This should work without problems.</p>

<p>Each classifier has a <code>fit</code> method and a <code>predict</code> method. See
<a href="http://scikit-learn.org/stable/auto_examples/svm/plot_iris.html">iris example</a>
to get a feeling how to use it. It provides a lot of useful functions like
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.train_test_split.html"><code>train_test_split</code></a>
and has an awesome documentation.</p>

<p>You don’t need this for Lasagne, but it might be good to use sklearn and
Lasagne in combination.</p>

<h2 id="tocAnchor-1-3">Graphics drivers and CUDA</h2>

<p>Make sure CUDA runs on your system by the following commands.
If it doesn’t run, you could try the following guides:</p>

<ul>
  <li><a href="http://askubuntu.com/q/451672/10425">Installing and testing CUDA in Ubuntu 14.04</a></li>
  <li><a href="http://www.r-tutor.com/gpu-computing/cuda-installation/cuda6.5-ubuntu">Installing CUDA Toolkit 6.5 on Ubuntu 14.04 Linux</a></li>
  <li><a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-linux/#axzz3XaMVcNwV">NVIDIA CUDA Getting Started Guide for Linux</a></li>
</ul>

<p>Run</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>$ nvidia-smi -L
GPU 0: GeForce GTX TITAN Black (UUID: GPU-abcdef12-abcd-1234-1234-01234567890a)

$ nvcc --version
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2013 NVIDIA Corporation
Built on Thu_Mar_13_11:58:58_PDT_2014
Cuda compilation tools, release 6.0, V6.0.1

$ nvidia-smi -a

==============NVSMI LOG==============

Timestamp                           : Fri Apr 17 18:44:41 2015
Driver Version                      : 331.79

Attached GPUs                       : 1
GPU 0000:01:00.0
    Product Name                    : GeForce GTX TITAN Black
    Display Mode                    : N/A
    Display Active                  : N/A
    Persistence Mode                : Disabled
    Accounting Mode                 : N/A
    Accounting Mode Buffer Size     : N/A
    Driver Model
        Current                     : N/A
        Pending                     : N/A
    Serial Number                   : N/A
    GPU UUID                        : GPU-fcff168f-a045-2f95-7a4f-8e1cf26a24eb
    Minor Number                    : 0
    VBIOS Version                   : 80.80.4E.00.01
    Inforom Version
        Image Version               : N/A
        OEM Object                  : N/A
        ECC Object                  : N/A
        Power Management Object     : N/A
    GPU Operation Mode
        Current                     : N/A
        Pending                     : N/A
    PCI
        Bus                         : 0x01
        Device                      : 0x00
        Domain                      : 0x0000
        Device Id                   : 0x100C10DE
        Bus Id                      : 0000:01:00.0
        Sub System Id               : 0x106610DE
        GPU Link Info
            PCIe Generation
                Max                 : N/A
                Current             : N/A
            Link Width
                Max                 : N/A
                Current             : N/A
        Bridge Chip
            Type                    : N/A
            Firmware                : N/A
    Fan Speed                       : 26 %
    Performance State               : N/A
    Clocks Throttle Reasons         : N/A
    FB Memory Usage
        Total                       : 6143 MiB
        Used                        : 39 MiB
        Free                        : 6104 MiB
    BAR1 Memory Usage
        Total                       : N/A
        Used                        : N/A
        Free                        : N/A
    Compute Mode                    : Default
    Utilization
        Gpu                         : N/A
        Memory                      : N/A
    Ecc Mode
        Current                     : N/A
        Pending                     : N/A
    ECC Errors
        Volatile
            Single Bit
                Device Memory       : N/A
                Register File       : N/A
                L1 Cache            : N/A
                L2 Cache            : N/A
                Texture Memory      : N/A
                Total               : N/A
            Double Bit
                Device Memory       : N/A
                Register File       : N/A
                L1 Cache            : N/A
                L2 Cache            : N/A
                Texture Memory      : N/A
                Total               : N/A
        Aggregate
            Single Bit
                Device Memory       : N/A
                Register File       : N/A
                L1 Cache            : N/A
                L2 Cache            : N/A
                Texture Memory      : N/A
                Total               : N/A
            Double Bit
                Device Memory       : N/A
                Register File       : N/A
                L1 Cache            : N/A
                L2 Cache            : N/A
                Texture Memory      : N/A
                Total               : N/A
    Retired Pages
        Single Bit ECC              : N/A
        Double Bit ECC              : N/A
        Pending                     : N/A
    Temperature
        Gpu                         : 29 C
    Power Readings
        Power Management            : N/A
        Power Draw                  : N/A
        Power Limit                 : N/A
        Default Power Limit         : N/A
        Enforced Power Limit        : N/A
        Min Power Limit             : N/A
        Max Power Limit             : N/A
    Clocks
        Graphics                    : N/A
        SM                          : N/A
        Memory                      : N/A
    Applications Clocks
        Graphics                    : N/A
        Memory                      : N/A
    Default Applications Clocks
        Graphics                    : N/A
        Memory                      : N/A
    Max Clocks
        Graphics                    : N/A
        SM                          : N/A
        Memory                      : N/A
    Compute Processes               : N/A
</pre></div>
</div>
</div>

<p>to see if CUDA was installed correctly.</p>

<h2 id="tocAnchor-1-4">Theano</h2>

<p>The installation of Theano is a bit tricky (see <a href="http://deeplearning.net/software/theano/install.html">official page</a>). I don’t remember if I installed additional packages, but try</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>$ sudo -H pip install theano
</pre></div>
</div>
</div>

<p>Make sure that your <code>~/.theanorc</code> exists and looks like this:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>[global]
device=gpu
floatX=float32
</pre></div>
</div>
</div>

<p>Note that <code>float32</code> is required, even if you have a 64bit system.</p>

<p>To test your installation, save the following as <code>theanotest.py</code> and execute
it with <code>python theanotest.py</code>:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#777">#!/usr/bin/env python</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">theano</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">function</span>, <span style="color:#B44;font-weight:bold">config</span>, <span style="color:#B44;font-weight:bold">shared</span>, <span style="color:#B44;font-weight:bold">sandbox</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">theano.tensor</span> <span style="color:#080;font-weight:bold">as</span> T
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">numpy</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">time</span>

vlen = <span style="color:#00D">10</span> * <span style="color:#00D">30</span> * <span style="color:#00D">768</span>  <span style="color:#777"># 10 x #cores x # threads per core</span>
iters = <span style="color:#00D">1000</span>

rng = numpy.random.RandomState(<span style="color:#00D">22</span>)
x = shared(numpy.asarray(rng.rand(vlen), config.floatX))
f = function([], T.exp(x))
<span style="color:#080;font-weight:bold">print</span> f.maker.fgraph.toposort()
t0 = time.time()
<span style="color:#080;font-weight:bold">for</span> i <span style="color:#080;font-weight:bold">in</span> <span style="color:#369;font-weight:bold">xrange</span>(iters):
    r = f()
t1 = time.time()
<span style="color:#080;font-weight:bold">print</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Looping %d times took</span><span style="color:#710">'</span></span> % iters, t1 - t0, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">seconds</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">print</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Result is</span><span style="color:#710">'</span></span>, r
<span style="color:#080;font-weight:bold">if</span> numpy.any([<span style="color:#369;font-weight:bold">isinstance</span>(x.op, T.Elemwise) <span style="color:#080;font-weight:bold">for</span> x <span style="color:#080;font-weight:bold">in</span> f.maker.fgraph.toposort()]):
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Used the cpu</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">else</span>:
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Used the gpu</span><span style="color:#710">'</span></span>)
</pre></div>
</div>
</div>

<p>It should print the following (well, something similar):</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>Using gpu device 0: GeForce GTX TITAN Black
[GpuElemwise{exp,no_inplace}(&lt;CudaNdarrayType(float32, vector)&gt;), HostFromGpu(GpuElemwise{exp,no_inplace}.0)]
Looping 1000 times took 0.38205909729 seconds
Result is [ 1.23178029  1.61879349  1.52278066 ...,  2.20771813  2.29967761
  1.62323296]
Used the gpu
</pre></div>
</div>
</div>

<p>Especially “used the gpu” is important. Theano code work on both, CPU and GPU.
If you have a GPU and it does not currently work on a task and it is configured
correctly, then Theano should automatically use the GPU.</p>

<p>(Don’t try to run two Theano scripts at a time … weird things could happen.)</p>

<h2 id="tocAnchor-1-5">Lasagne</h2>

<p>Lasagne is hosted at Github: <a href="https://github.com/Lasagne/Lasagne">https://github.com/Lasagne/Lasagne</a></p>

<p>Currently, it is not on pip as Sander wants to wait until we get to version
1.0. So you have to install it manually:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>$ git clone https://github.com/Lasagne/Lasagne.git
$ cd Lasagne
Lasagne$ sudo -H python setup.py install
</pre></div>
</div>
</div>

<p>Now you can test if it worked by executing the MNIST example in Lasagne
(<a href="http://yann.lecun.com/exdb/mnist/">MNIST</a> is a huge digit dataset). This
might first take some time to download, but should then run quite fast. If
your machine does not use the GPU it will take ages (e.g. on my laptop it takes
about a minute for one epoch)</p>

<pre><code>Lasagne/examples$ python mnist.py
Loading data...
Downloading MNIST dataset
Building model and compiling functions...
/usr/local/lib/python2.7/dist-packages/Lasagne-0.1dev-py2.7.egg/lasagne/init.py:30: UserWarning: The uniform initializer no longer uses Glorot et al.'s approach to determine the bounds, but defaults to the range (-0.01, 0.01) instead. Please use the new GlorotUniform initializer to get the old behavior. GlorotUniform is now the default for all layers.
  warnings.warn("The uniform initializer no longer uses Glorot et al.'s "
/usr/local/lib/python2.7/dist-packages/Lasagne-0.1dev-py2.7.egg/lasagne/layers/helper.py:55: UserWarning: get_all_layers() has been changed to return layers in topological order. The former implementation is still available as get_all_layers_old(), but will be removed before the first release of Lasagne. To ignore this warning, use `warnings.filterwarnings('ignore', '.*topo.*')`.
  warnings.warn("get_all_layers() has been changed to return layers in "
Starting training...
Epoch 1 of 500 took 72.593s
  training loss:        1.330231
  validation loss:        0.470251
  validation accuracy:        87.54 %%
</code></pre>

<h2 id="tocAnchor-1-6">nolearn</h2>

<p><a href="https://github.com/dnouri/nolearn">nolearn</a> is another Python package. It was
created to make using Lasagne even simpler.</p>

<p>You can install it via</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>$ git clone https://github.com/dnouri/nolearn.git
$ cd nolearn
$ python setup.py install --user
</pre></div>
</div>
</div>

<p>For example, the following code downloads the MNIST dataset, trains a model on
it and evaluates the result for a single image:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#777">#!/usr/bin/env python</span>

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">lasagne</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">lasagne</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">layers</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">lasagne.updates</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">nesterov_momentum</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">nolearn.lasagne</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">NeuralNet</span>

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">sys</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">os</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">gzip</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">pickle</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">numpy</span>


PY2 = sys.version_info[<span style="color:#00D">0</span>] == <span style="color:#00D">2</span>

<span style="color:#080;font-weight:bold">if</span> PY2:
    <span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">urllib</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">urlretrieve</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">pickle_load</span>(f, encoding):
        <span style="color:#080;font-weight:bold">return</span> pickle.load(f)
<span style="color:#080;font-weight:bold">else</span>:
    <span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">urllib.request</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">urlretrieve</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">pickle_load</span>(f, encoding):
        <span style="color:#080;font-weight:bold">return</span> pickle.load(f, encoding=encoding)

DATA_URL = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://deeplearning.net/data/mnist/mnist.pkl.gz</span><span style="color:#710">'</span></span>
DATA_FILENAME = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mnist.pkl.gz</span><span style="color:#710">'</span></span>


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">_load_data</span>(url=DATA_URL, filename=DATA_FILENAME):
    <span style="color:#D42"><span style="color:black">"""</span><span>Load data from `url` and store the result in `filename`.</span><span style="color:black">"""</span></span>
    <span style="color:#080;font-weight:bold">if</span> <span style="color:#080;font-weight:bold">not</span> os.path.exists(filename):
        print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Downloading MNIST dataset</span><span style="color:#710">"</span></span>)
        urlretrieve(url, filename)

    <span style="color:#080;font-weight:bold">with</span> gzip.open(filename, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rb</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">as</span> f:
        <span style="color:#080;font-weight:bold">return</span> pickle_load(f, encoding=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">latin-1</span><span style="color:#710">'</span></span>)


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">load_data</span>():
    <span style="color:#D42"><span style="color:black">"""</span><span>Get data with labels, split into training, validation and test set.</span><span style="color:black">"""</span></span>
    data = _load_data()
    X_train, y_train = data[<span style="color:#00D">0</span>]
    X_valid, y_valid = data[<span style="color:#00D">1</span>]
    X_test, y_test = data[<span style="color:#00D">2</span>]
    y_train = numpy.asarray(y_train, dtype=numpy.int32)
    y_valid = numpy.asarray(y_valid, dtype=numpy.int32)
    y_test = numpy.asarray(y_test, dtype=numpy.int32)

    <span style="color:#080;font-weight:bold">return</span> <span style="color:#369;font-weight:bold">dict</span>(
        X_train=X_train,
        y_train=y_train,
        X_valid=X_valid,
        y_valid=y_valid,
        X_test=X_test,
        y_test=y_test,
        num_examples_train=X_train.shape[<span style="color:#00D">0</span>],
        num_examples_valid=X_valid.shape[<span style="color:#00D">0</span>],
        num_examples_test=X_test.shape[<span style="color:#00D">0</span>],
        input_dim=X_train.shape[<span style="color:#00D">1</span>],
        output_dim=<span style="color:#00D">10</span>,
    )


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">nn_example</span>(data):
    net1 = NeuralNet(
        layers=[(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">input</span><span style="color:#710">'</span></span>, layers.InputLayer),
                (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">hidden</span><span style="color:#710">'</span></span>, layers.DenseLayer),
                (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">output</span><span style="color:#710">'</span></span>, layers.DenseLayer),
                ],
        <span style="color:#777"># layer parameters:</span>
        input_shape=(<span style="color:#069">None</span>, <span style="color:#00D">28</span>*<span style="color:#00D">28</span>),
        hidden_num_units=<span style="color:#00D">100</span>,  <span style="color:#777"># number of units in 'hidden' layer</span>
        output_nonlinearity=lasagne.nonlinearities.softmax,
        output_num_units=<span style="color:#00D">10</span>,  <span style="color:#777"># 10 target values for the digits 0, 1, 2, ..., 9</span>

        <span style="color:#777"># optimization method:</span>
        update=nesterov_momentum,
        update_learning_rate=<span style="color:#60E">0.01</span>,
        update_momentum=<span style="color:#60E">0.9</span>,

        max_epochs=<span style="color:#00D">10</span>,
        verbose=<span style="color:#00D">1</span>,
        )

    <span style="color:#777"># Train the network</span>
    net1.fit(data[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">X_train</span><span style="color:#710">'</span></span>], data[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">y_train</span><span style="color:#710">'</span></span>])

    <span style="color:#777"># Try the network on new data</span>
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Feature vector (100-110): %s</span><span style="color:#710">"</span></span> % data[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">X_test</span><span style="color:#710">'</span></span>][<span style="color:#00D">0</span>][<span style="color:#00D">100</span>:<span style="color:#00D">110</span>])
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Label: %s</span><span style="color:#710">"</span></span> % <span style="color:#369;font-weight:bold">str</span>(data[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">y_test</span><span style="color:#710">'</span></span>][<span style="color:#00D">0</span>]))
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Predicted: %s</span><span style="color:#710">"</span></span> % <span style="color:#369;font-weight:bold">str</span>(net1.predict([data[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">X_test</span><span style="color:#710">'</span></span>][<span style="color:#00D">0</span>]])))


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">main</span>():
    data = load_data()
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Got %i testing datasets.</span><span style="color:#710">"</span></span> % <span style="color:#369;font-weight:bold">len</span>(data[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">X_train</span><span style="color:#710">'</span></span>]))
    nn_example(data)

<span style="color:#080;font-weight:bold">if</span> __name__ == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">__main__</span><span style="color:#710">'</span></span>:
    main()
</pre></div>
</div>
</div>

<p>The output is</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre># Neural Network with 79510 learnable parameters

## Layer information

  #  name      size
---  ------  ------
  0  input      784
  1  hidden     100
  2  output      10

  epoch    train loss    valid loss    train/val    valid acc  dur
-------  ------------  ------------  -----------  -----------  -----
      1       0.59132       0.32314      1.82993      0.90988  1.70s
      2       0.30733       0.26644      1.15348      0.92623  1.96s
      3       0.25879       0.23606      1.09629      0.93363  2.09s
      4       0.22680       0.21424      1.05865      0.93897  2.13s
      5       0.20187       0.19633      1.02827      0.94313  2.21s
      6       0.18129       0.18187      0.99685      0.94758  1.81s
      7       0.16398       0.16992      0.96506      0.95074  2.14s
      8       0.14941       0.16020      0.93265      0.95262  1.88s
      9       0.13704       0.15189      0.90222      0.95460  2.15s
     10       0.12633       0.14464      0.87342      0.95707  2.21s
Feature vector (100-110): [ 0.  0.  0.  0.  0.  0.  0.  0.  0.  0.]
Label: 7
Predicted: [7]
</pre></div>
</div>
</div>

<h2 id="tocAnchor-1-7">See also</h2>

<ul>
  <li><a href="http://www.pyimagesearch.com/2014/09/22/getting-started-deep-learning-python/">Getting Started with Deep Learning and Python</a></li>
</ul>

                        </div>
                        <div class="postmeta">Posted in
                            
                                <a href="//martin-thoma.com/category/machine-learning/">machine learning</a><!--TODO: Displayed category name should be upper case! -->
                             | Tags:
                            
                                
                                    <a href="//martin-thoma.com/tag/python/">Python</a>
                                
                            
                                , <a href="//martin-thoma.com/tag/machine-learning/">Machine Learning</a>
                                
                             by <a rel="author" class="vcard author post-author" itemprop="author" href="//martin-thoma.com/author/martin-thoma/"><span class="fn" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Martin Thoma</span></span></a> on <span class="updated"><span class="value-title" title="2015-04-17 19:26:00 +0200">
                                April
                                17th
                                  ,
                                2015</span></span></div>

                            <div class="navigation clearfix">
                                <div class="alignleft">
                                
                                    &laquo; <a href="//martin-thoma.com/echtzeitsysteme-klausur/" rel="prev">Echtzeitsysteme - Klausur</a>
                                
                                </div>
                                <div class="alignright">
                                
                                    <a href="//martin-thoma.com/mustererkennung-klausur/" rel="next">Mustererkennung - Klausur</a> &raquo;
                                
                                </div>
                            </div>

                        </article>
                        <div id="respond">
                            <h3>Leave a Reply</h3>
                                <!-- comment discuss code -->
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'martinthoma'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="//disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <!-- comment discuss code -->

                        </div>
                    </div>
                </div>
            <div class="span-8 last">
                <div id="subscriptions">
<a href="//martin-thoma.com/feed/"><img src="//martin-thoma.com/css/images/rss.png" alt="Subscribe to RSS Feed" title="Subscribe to RSS Feed" width="72" height="47" /></a>
<a href="https://twitter.com/#!/themoosemind" title="Follow me on Twitter!"><img src="//martin-thoma.com/css/images/twitter.png" title="Follow me on Twitter!" alt="Follow me on Twitter!"  width="76" height="47" /></a>
</div>

                <div id="sidebar">
                <!-- type: searchbox.html - TODO-->
<ul>
    <li id="search">
        <div class="searchlayout">
            <form method="get" id="searchform" action="//google.com/cse" role="search">
                <input type="hidden" name="cx" value="017345337424948206369:qrnnnentkkk" />
                <input type="search" value="" name="q" id="s" placeholder="Search with Google"/>
                <input type="image" src="//martin-thoma.com/css/images/search.gif" style="border:0; vertical-align: top;" alt="search"/>
            </form>
        </div>
    </li>
</ul>

                <div class="addthis_toolbox">
    <div class="custom_images">
            <a href="//twitter.com/share?url=//martin-thoma.com/lasagne-for-python-newbies&amp;hashtags=python,machine-learning,&amp;via=themoosemind" target="_blank"><img src="//martin-thoma.com/css/images/socialicons/twitter.png" width="32" height="32" alt="Twitter" /></a>
            <a href="//del.icio.us/post?url=//martin-thoma.com/lasagne-for-python-newbies&amp;title=Lasagne%20for%20Python%20Newbies" target="_blank"><img src="//martin-thoma.com/css/images/socialicons/delicious.png" width="32" height="32" alt="Delicious" /></a>
            <a href="//www.facebook.com/sharer.php?u=//martin-thoma.com/lasagne-for-python-newbies" target="_blank"><img src="//martin-thoma.com/css/images/socialicons/facebook.png" width="32" height="32" alt="Facebook" /></a>
            <a href="//digg.com/submit?phase=2&amp;url=//martin-thoma.com/lasagne-for-python-newbies&amp;title=Lasagne%20for%20Python%20Newbies" target="_blank"><img src="//martin-thoma.com/css/images/socialicons/digg.png" width="32" height="32" alt="Digg" /></a>
            <a href="//www.stumbleupon.com/submit?url=//martin-thoma.com/lasagne-for-python-newbies&amp;title=Lasagne%20for%20Python%20Newbies" target="_blank"><img src="//martin-thoma.com/css/images/socialicons/stumbleupon.png" width="32" height="32" alt="Stumbleupon" /></a>
            <a href="//plusone.google.com/_/+1/confirm?hl=en&amp;url=//martin-thoma.com/lasagne-for-python-newbies" target="_blank"><img src="//martin-thoma.com/css/images/socialicons/gplus.png" width="32" height="32" alt="Google Plus" /></a>
            <a href="//reddit.com/submit?url=//martin-thoma.com/lasagne-for-python-newbies&amp;title=Lasagne%20for%20Python%20Newbies" target="_blank"><img src="//martin-thoma.com/css/images/socialicons/reddit.png" width="32" height="32" alt="Reddit" /></a>
    </div>
</div>

                <ul>
                    <li id="categories-3" class="widget widget_categories">
                        <!-- type: categories -->
<h2 class="widgettitle">Categories</h2>
    <ul>
        <li class="cat-item cat-item-11"><a href="//martin-thoma.com/category/code/" title="Tipps for coding in different languages like Python oder C++.">Code</a></li>
        <li class="cat-item cat-item-21"><a href="//martin-thoma.com/category/web/" title="New emerging websites and technologies.">The Web</a></li>
        <li class="cat-item cat-item-31"><a href="//martin-thoma.com/category/cyberculture/" title="Lolcats, planking, Trollfaces, ...">Cyberculture</a></li>
        <li class="cat-item cat-item-3404"><a href="//martin-thoma.com/category/maths/" title="View all posts filed under Mathematics">Mathematics</a></li>
        <li class="cat-item cat-item-881"><a href="//martin-thoma.com/category/bits-and-bytes/" title="Sometimes posts don&#039;t fit in any category.">My bits and bytes</a></li>
        <li class="cat-item cat-item-41"><a href="//martin-thoma.com/category/deutschland/" title="[All Posts here are written in German about German topics] - Die Bahn, unsere Politik und Europa.">German posts</a></li>
    </ul>

                    </li>
                </ul>
                </div>
            </div>
        </div><!--/container-->
            <footer id="footer">
                <a href="//martin-thoma.com"><strong itemprop="publisher">Martin Thoma</strong></a> -  A blog about Code, the Web and Cyberculture. <br />
                <div class="footer-credits">
                    <a href="http://flexithemes.com/themes/modern-style/">Modern Style</a> theme by <a href="http://flexithemes.com/">FlexiThemes</a>
                </div>
            </footer><!--/footer-->

    </div><!--/wrapper-->
<!-- type: footer -->
<!-- TOC Plus -->
<script type='text/javascript'>
/* <![CDATA[ */
var tocplus = {"visibility_show":"show","visibility_hide":"hide","width":"275px"};
/* ]]> */
</script>
<script type='text/javascript' src="//martin-thoma.com/js/tocplus-front.js"></script>
<script>
(function(){
    'use strict';

    /*
    Create intra-page links
    Requires that your headings already have an `id` attribute set (because that's what jekyll does)
    For every heading in your page, this adds a little anchor link `#` that you can click to get a permalink to the heading.
    Ignores `h1`, because you should only have one per page.
    The text content of the tag is used to generate the link, so it will fail "gracefully-ish" if you have duplicate heading text.

    Credit: https://gist.github.com/SimplGy/a229d25cdb19d7f21231
     */

    var headingNodes = [], results, link,
        tags = ['h2', 'h3', 'h4', 'h5', 'h6'];

    tags.forEach(function(tag){
        var contentTag = document.getElementById('contentAfterTitle');
      results = contentTag.getElementsByTagName(tag);
      Array.prototype.push.apply(headingNodes, results);
    });

    headingNodes.forEach(function(node){
      link = document.createElement('a');
      link.className = 'deepLink';
      link.textContent = ' ¶';
      link.href = '#' + node.getAttribute('id');
      node.appendChild(link);
    });

  })();
</script>
</body>
</html>

